<roblox version="4">
  <Item class="Lighting" referent="0">
    <Properties>
      <string name="Name">Lighting</string>
      <Color3 name="Ambient">
        <R>0</R>
        <G>0</G>
        <B>0</B>
      </Color3>
      <float name="Brightness">2</float>
      <bool name="GlobalShadows">true</bool>
      <bool name="Outlines">false</bool>
      <token name="Technology">1</token>
    </Properties>
  </Item>
  <Item class="ReplicatedFirst" referent="1">
    <Properties>
      <string name="Name">ReplicatedFirst</string>
    </Properties>
  </Item>
  <Item class="ReplicatedStorage" referent="2">
    <Properties>
      <string name="Name">ReplicatedStorage</string>
    </Properties>
    <Item class="Folder" referent="3">
      <Properties>
        <string name="Name">Assets</string>
      </Properties>
    </Item>
    <Item class="Folder" referent="4">
      <Properties>
        <string name="Name">Constants</string>
      </Properties>
      <Item class="ModuleScript" referent="5">
        <Properties>
          <string name="Name">Theme</string>
          <string name="Source">local Theme = {
	Colors = {
		Background = Color3.fromRGB(15, 15, 15),
		Panel = Color3.fromRGB(30, 30, 35),
		AccentBlue = Color3.fromRGB(0, 162, 255),
		AccentYellow = Color3.fromRGB(255, 215, 0),
		AccentGold = Color3.fromRGB(255, 215, 0),
		TextMain = Color3.fromRGB(255, 255, 255),
		TextSecondary = Color3.fromRGB(180, 180, 180),
		Success = Color3.fromRGB(0, 255, 120),
		Delete = Color3.fromRGB(255, 70, 70),
		Overlay = Color3.fromRGB(0, 0, 0)
	},
	
	Fonts = {
		Main = Enum.Font.Gotham,
		Bold = Enum.Font.GothamBold,
		Black = Enum.Font.GothamBlack
	},
	
	Transitions = {
		Default = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
		Quick = TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
		Smooth = TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
	}
}

return Theme</string>
        </Properties>
      </Item>
    </Item>
    <Item class="Folder" referent="6">
      <Properties>
        <string name="Name">Enums</string>
      </Properties>
    </Item>
    <Item class="Folder" referent="7">
      <Properties>
        <string name="Name">Framework</string>
      </Properties>
      <Item class="ModuleScript" referent="8">
        <Properties>
          <string name="Name">Network</string>
          <string name="Source">local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")

local Network = {}
local Remotes = ReplicatedStorage:WaitForChild("Remotes")

function Network.GetRemote(name, type)
	local remote = Remotes:FindFirstChild(name)
	if not remote and RunService:IsServer() then
		remote = Instance.new(type or "RemoteEvent")
		remote.Name = name
		remote.Parent = Remotes
	end
	return remote
end

function Network.FireServer(name, ...)
	local remote = Network.GetRemote(name)
	if remote then
		remote:FireServer(...)
	end
end

function Network.FireClient(player, name, ...)
	local remote = Network.GetRemote(name)
	if remote then
		remote:FireClient(player, ...)
	end
end

function Network.OnServerEvent(name, callback)
	local remote = Network.GetRemote(name)
	if remote then
		return remote.OnServerEvent:Connect(callback)
	end
end

function Network.OnClientEvent(name, callback)
	local remote = Network.GetRemote(name)
	if remote then
		return remote.OnClientEvent:Connect(callback)
	end
end

return Network</string>
        </Properties>
      </Item>
    </Item>
    <Item class="ModuleScript" referent="9">
      <Properties>
        <string name="Name">Hello</string>
        <string name="Source">return function()
	print("Hello, world!")
end</string>
      </Properties>
    </Item>
    <Item class="ModuleScript" referent="10">
      <Properties>
        <string name="Name">PlayerData</string>
        <string name="Source">local PlayerData = {}
PlayerData.__index = PlayerData

function PlayerData.new(player)
	local self = setmetatable({}, PlayerData)
	self.Player = player
	self.Data = {
		Level = 1,
		Experience = 0,
		Currency = 100,
		Inventory = {},
		Settings = {
			FOV = 70,
			Sensitivity = 1
		}
	}
	return self
end

return PlayerData</string>
      </Properties>
    </Item>
    <Item class="Folder" referent="11">
      <Properties>
        <string name="Name">Types</string>
      </Properties>
      <Item class="ModuleScript" referent="12">
        <Properties>
          <string name="Name">GameData</string>
          <string name="Source">export type PlayerProfile = {
	Level: number,
	XP: number,
	MaxXP: number,
	Currency: number, -- CP
	Username: string,
}

export type Challenge = {
	Id: string,
	Title: string,
	Progress: number,
	Goal: number,
	RewardXP: number,
	ExpiresIn: number?, -- Seconds
}

export type LobbyState = {
	PlayerCount: number,
	MaxPlayers: number,
	Status: "Searching" | "Waiting" | "Starting" | "InGame",
	SquadCount: number,
	MaxSquad: number,
}

return {}</string>
        </Properties>
      </Item>
    </Item>
    <Item class="Folder" referent="13">
      <Properties>
        <string name="Name">Utils</string>
      </Properties>
      <Item class="ModuleScript" referent="14">
        <Properties>
          <string name="Name">Spring</string>
          <string name="Source">--[[
	Robust Physics Spring
	Handles both Scalars and Vector3
]]
local Spring = {}
Spring.__index = Spring

function Spring.new(position)
	local self = setmetatable({}, Spring)
	
	self.Target = position or Vector3.zero
	self.Position = position or Vector3.zero
	self.Velocity = (typeof(self.Target) == "Vector3") and Vector3.zero or 0
	
	self.Mass = 1
	self.Force = 50
	self.Damper = 1 -- 1 = Critical Damping
	self.Speed = 4
	
	return self
end

function Spring:Update(dt)
	-- Clamp dt to prevent explosions on lag spikes
	dt = math.min(dt, 0.05) * self.Speed
	
	local displacement = self.Position - self.Target
	local springForce = -self.Force * displacement
	local dampingForce = self.Damper * self.Velocity
	
	local acceleration = (springForce - dampingForce) / self.Mass
	
	self.Velocity = self.Velocity + acceleration * dt
	self.Position = self.Position + self.Velocity * dt
	
	-- NaN check
	if typeof(self.Position) == "number" then
		if self.Position ~= self.Position then self.Position = self.Target end
	elseif self.Position.X ~= self.Position.X then
		self.Position = self.Target
	end
	
	return self.Position
end

function Spring:Shove(force)
	self.Velocity = self.Velocity + force
end

return Spring</string>
        </Properties>
      </Item>
    </Item>
    <Item class="Folder" referent="15">
      <Properties>
        <string name="Name">Vendor</string>
      </Properties>
    </Item>
    <Item class="Folder" referent="16">
      <Properties>
        <string name="Name">Remotes</string>
      </Properties>
    </Item>
  </Item>
  <Item class="ServerScriptService" referent="17">
    <Properties>
      <string name="Name">ServerScriptService</string>
    </Properties>
    <Item class="Folder" referent="18">
      <Properties>
        <string name="Name">Components</string>
      </Properties>
    </Item>
    <Item class="Script" referent="19">
      <Properties>
        <string name="Name">Main</string>
        <token name="RunContext">0</token>
        <string name="Source"><![CDATA[local ServerScriptService = game:GetService("ServerScriptService")
local Services = ServerScriptService.Services

local PlayerService = require(Services.PlayerService)
local LeaderboardService = require(Services.LeaderboardService)
local MatchmakingService = require(Services.MatchmakingService)
local LoadoutService = require(Services.LoadoutService)

-- Initialize Services in order
PlayerService.Init()
LeaderboardService.Init()
MatchmakingService.Init()
LoadoutService.Init()

print("Server initialized with all foundational services")
]]></string>
      </Properties>
    </Item>
    <Item class="Folder" referent="20">
      <Properties>
        <string name="Name">Managers</string>
      </Properties>
    </Item>
    <Item class="Folder" referent="21">
      <Properties>
        <string name="Name">Modules</string>
      </Properties>
    </Item>
    <Item class="Folder" referent="22">
      <Properties>
        <string name="Name">Services</string>
      </Properties>
      <Item class="ModuleScript" referent="23">
        <Properties>
          <string name="Name">DataService</string>
          <string name="Source">local DataStoreService = game:GetService("DataStoreService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local PlayerData = require(ReplicatedStorage:WaitForChild("PlayerData"))
local Network = require(ReplicatedStorage.Framework.Network)

local DataService = {}
local PlayerDataStore = DataStoreService:GetDataStore("GameData_v1")

local sessionData = {}

function DataService.LoadData(player)
	local userId = player.UserId
	local key = "Player_" .. userId
	
	local success, data = pcall(function()
		return PlayerDataStore:GetAsync(key)
	end)
	
	if success then
		local pData = PlayerData.new(player)
		if data then
			-- Merge saved data into template
			for k, v in pairs(data) do
				pData.Data[k] = v
			end
		end
		sessionData[userId] = pData
		print("Data loaded for " .. player.Name)
		
		-- Fire to client
		Network.FireClient(player, "ProfileUpdate", {
			Username = player.Name,
			Level = pData.Data.Level,
			Currency = pData.Data.Currency
		})
		
		Network.FireClient(player, "ChallengesUpdate", {
			{Title = "Win 1 Match", Progress = 0, Goal = 1},
			{Title = "Get 5 Kills", Progress = 2, Goal = 5}
		})
		
		return pData
	else
		warn("Failed to load data for " .. player.Name)
		return nil
	end
end

function DataService.SaveData(player)
	local userId = player.UserId
	local pData = sessionData[userId]
	
	if pData then
		local key = "Player_" .. userId
		local success, err = pcall(function()
			PlayerDataStore:SetAsync(key, pData.Data)
		end)
		
		if not success then
			warn("Failed to save data for " .. player.Name .. ": " .. err)
		else
			print("Data saved for " .. player.Name)
		end
	end
end

function DataService.GetPlayerData(player)
	return sessionData[player.UserId]
end

return DataService</string>
        </Properties>
      </Item>
      <Item class="ModuleScript" referent="24">
        <Properties>
          <string name="Name">LeaderboardService</string>
          <string name="Source">local Players = game:GetService("Players")
local ServerScriptService = game:GetService("ServerScriptService")
local DataService = require(ServerScriptService.Services.DataService)

local LeaderboardService = {}

function LeaderboardService.Init()
	Players.PlayerAdded:Connect(function(player)
		LeaderboardService.CreateLeaderboard(player)
	end)
end

function LeaderboardService.CreateLeaderboard(player)
	local leaderstats = Instance.new("Folder")
	leaderstats.Name = "leaderstats"
	leaderstats.Parent = player
	
	local level = Instance.new("IntValue")
	level.Name = "Level"
	level.Parent = leaderstats
	
	local currency = Instance.new("IntValue")
	currency.Name = "Currency"
	currency.Parent = leaderstats
	
	-- Update values when data loads
	task.spawn(function()
		local pData = nil
		repeat
			task.wait(0.5)
			pData = DataService.GetPlayerData(player)
		until pData or not player.Parent
		
		if pData then
			level.Value = pData.Data.Level
			currency.Value = pData.Data.Currency
			
			-- Optional: Listen for data changes if we add signals to PlayerData
		end
	end)
end

return LeaderboardService</string>
        </Properties>
      </Item>
      <Item class="ModuleScript" referent="25">
        <Properties>
          <string name="Name">LoadoutService</string>
          <string name="Source"><![CDATA[--[[
	LoadoutService - Scalable loadout persistence system
	Handles server-side storage and retrieval of player weapon loadouts
	Designed for integration with DataService for persistence
]]
local ServerScriptService = game:GetService("ServerScriptService")
local DataService = require(ServerScriptService.Services.DataService)

local LoadoutService = {}

-- In-memory cache (will be integrated with DataService for persistence)
local playerLoadouts = {}

-- Default loadout structure (abstracted for scalability)
local function createDefaultLoadout()
	return {
		Id = 1,
		Name = "Default Loadout",
		Primary = {
			Name = "M4",
			Category = "Assault Rifle",
			Attachments = {}, -- For future gunsmith integration
			Progress = 0,
			Max = 2200
		},
		Secondary = {
			Name = "P890",
			Category = "Handgun",
			Attachments = {},
			Progress = 0,
			Max = 1000
		},
		Perks = {"E.O.D.", "Hardline", "Ghost"},
		Lethal = "Frag",
		Tactical = "Stun"
	}
end

-- Get loadouts for player
function LoadoutService.GetLoadouts(player)
	if not playerLoadouts[player.UserId] then
		-- Initialize with default loadout
		playerLoadouts[player.UserId] = {
			createDefaultLoadout()
		}
	end
	return playerLoadouts[player.UserId]
end

-- Save loadout for player
function LoadoutService.SaveLoadout(player, loadoutData)
	if not playerLoadouts[player.UserId] then
		playerLoadouts[player.UserId] = {}
	end
	
	local loadouts = playerLoadouts[player.UserId]
	
	-- Update existing or add new
	local found = false
	for i, loadout in ipairs(loadouts) do
		if loadout.Id == loadoutData.Id then
			loadouts[i] = loadoutData
			found = true
			break
		end
	end
	
	if not found then
		table.insert(loadouts, loadoutData)
	end
	
	-- TODO: Integrate with DataService for persistence
	-- DataService.UpdatePlayerLoadouts(player, loadouts)
	
	print("[LoadoutService] Loadout saved for " .. player.Name)
end

-- Delete loadout
function LoadoutService.DeleteLoadout(player, loadoutId)
	local loadouts = playerLoadouts[player.UserId]
	if loadouts then
		for i, loadout in ipairs(loadouts) do
			if loadout.Id == loadoutId then
				table.remove(loadouts, i)
				print("[LoadoutService] Loadout " .. loadoutId .. " deleted for " .. player.Name)
				return true
			end
		end
	end
	return false
end

-- Initialize service
function LoadoutService.Init()
	-- Cleanup on player leaving (save to DataService)
	local Players = game:GetService("Players")
	Players.PlayerRemoving:Connect(function(player)
		-- TODO: Save loadouts to DataService
		playerLoadouts[player.UserId] = nil
	end)
	
	print("[LoadoutService] Initialized")
end

return LoadoutService
]]></string>
        </Properties>
      </Item>
      <Item class="ModuleScript" referent="26">
        <Properties>
          <string name="Name">MatchmakingService</string>
          <string name="Source"><![CDATA[--[[
	MatchmakingService - Scalable matchmaking system
	Handles lobby creation, player matching, and queue management
	Designed for extensibility (supports different game modes, skill-based matching, etc.)
]]
local Players = game:GetService("Players")

local MatchmakingService = {}

-- Lobby state management (scalable for different game modes)
local lobbies = {}
local queue = {} -- Players waiting for matches

-- Lobby configuration (abstracted for easy extension)
local LOBBY_CONFIG = {
	MaxPlayers = 100, -- Battle Royale default
	MinPlayers = 10, -- Minimum to start
	GameMode = "BattleRoyale" -- Extensible enum
}

-- Create a new lobby
local function createLobby()
	local lobbyId = #lobbies + 1
	local lobby = {
		Id = lobbyId,
		Players = {},
		MaxPlayers = LOBBY_CONFIG.MaxPlayers,
		MinPlayers = LOBBY_CONFIG.MinPlayers,
		GameMode = LOBBY_CONFIG.GameMode,
		Status = "Waiting", -- Waiting, Starting, InProgress
		CreatedAt = tick()
	}
	lobbies[lobbyId] = lobby
	return lobby
end

-- Add player to queue
function MatchmakingService.QueuePlayer(player)
	if not table.find(queue, player) then
		table.insert(queue, player)
		print("[MatchmakingService] " .. player.Name .. " queued")
		
		-- Try to find or create lobby
		MatchmakingService.ProcessQueue()
	end
end

-- Remove player from queue
function MatchmakingService.DequeuePlayer(player)
	local index = table.find(queue, player)
	if index then
		table.remove(queue, index)
	end
end

-- Process queue and assign players to lobbies
function MatchmakingService.ProcessQueue()
	-- Find available lobby or create new one
	local availableLobby = nil
	for _, lobby in pairs(lobbies) do
		if lobby.Status == "Waiting" and #lobby.Players < lobby.MaxPlayers then
			availableLobby = lobby
			break
		end
	end
	
	if not availableLobby then
		availableLobby = createLobby()
	end
	
	-- Add players from queue to lobby
	while #queue > 0 and #availableLobby.Players < availableLobby.MaxPlayers do
		local player = table.remove(queue, 1)
		if player and player.Parent then
			table.insert(availableLobby.Players, player)
			print("[MatchmakingService] " .. player.Name .. " added to lobby " .. availableLobby.Id)
		end
	end
end

-- Initialize service
function MatchmakingService.Init()
	-- Cleanup on player leaving
	Players.PlayerRemoving:Connect(function(player)
		MatchmakingService.DequeuePlayer(player)
		-- Remove from any lobbies (extensible cleanup)
		for _, lobby in pairs(lobbies) do
			local index = table.find(lobby.Players, player)
			if index then
				table.remove(lobby.Players, index)
			end
		end
	end)
	
	print("[MatchmakingService] Initialized")
end

-- Get lobby for player (for future use)
function MatchmakingService.GetPlayerLobby(player)
	for _, lobby in pairs(lobbies) do
		if table.find(lobby.Players, player) then
			return lobby
		end
	end
	return nil
end

return MatchmakingService
]]></string>
        </Properties>
      </Item>
      <Item class="ModuleScript" referent="27">
        <Properties>
          <string name="Name">PlayerDataService</string>
          <string name="Source">local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local PlayerDataService = {}

-- Store player data in memory for now
local playerProfiles = {}
local playerChallenges = {}

-- Setup Remotes
local Remotes = ReplicatedStorage:FindFirstChild("Remotes")
if not Remotes then
	Remotes = Instance.new("Folder")
	Remotes.Name = "Remotes"
	Remotes.Parent = ReplicatedStorage
end

local ProfileUpdateEvent = Instance.new("RemoteEvent")
ProfileUpdateEvent.Name = "ProfileUpdate"
ProfileUpdateEvent.Parent = Remotes

local ChallengesUpdateEvent = Instance.new("RemoteEvent")
ChallengesUpdateEvent.Name = "ChallengesUpdate"
ChallengesUpdateEvent.Parent = Remotes

function PlayerDataService.Init()
	Players.PlayerAdded:Connect(function(player)
		-- Load Mock Data
		playerProfiles[player.UserId] = {
			Level = 350,
			XP = 15400,
			MaxXP = 20000,
			Currency = 2000,
			Username = player.Name
		}
		
		playerChallenges[player.UserId] = {
			{Id = "1", Title = "Win 1 Ranked Match", Progress = 1, Goal = 1, RewardXP = 500},
			{Id = "2", Title = "Kill 6 Enemies in BR", Progress = 2, Goal = 6, RewardXP = 150},
			{Id = "3", Title = "Win 3 BR Matches", Progress = 0, Goal = 3, RewardXP = 1000}
		}
		
		-- Send initial data
		task.wait(1) -- Wait for client to load
		PlayerDataService.UpdateClient(player)
	end)
end

function PlayerDataService.UpdateClient(player)
	local profile = playerProfiles[player.UserId]
	local challenges = playerChallenges[player.UserId]
	
	if profile then
		ProfileUpdateEvent:FireClient(player, profile)
	end
	if challenges then
		ChallengesUpdateEvent:FireClient(player, challenges)
	end
end

function PlayerDataService.Start()
	print("[PlayerDataService] Started")
end

return PlayerDataService</string>
        </Properties>
      </Item>
      <Item class="ModuleScript" referent="28">
        <Properties>
          <string name="Name">PlayerService</string>
          <string name="Source">local Players = game:GetService("Players")
local ServerScriptService = game:GetService("ServerScriptService")
local DataService = require(ServerScriptService.Services.DataService)

local PlayerService = {}

function PlayerService.Init()
	Players.PlayerAdded:Connect(function(player)
		PlayerService.OnPlayerAdded(player)
	end)
	
	Players.PlayerRemoving:Connect(function(player)
		PlayerService.OnPlayerRemoving(player)
	end)
end

function PlayerService.OnPlayerAdded(player)
	print("Player joined: " .. player.Name)
	DataService.LoadData(player)
	
	-- Here we could trigger character loading or other setup
end

function PlayerService.OnPlayerRemoving(player)
	print("Player leaving: " .. player.Name)
	DataService.SaveData(player)
end

return PlayerService</string>
        </Properties>
      </Item>
    </Item>
  </Item>
  <Item class="ServerStorage" referent="29">
    <Properties>
      <string name="Name">ServerStorage</string>
    </Properties>
  </Item>
  <Item class="SoundService" referent="30">
    <Properties>
      <string name="Name">SoundService</string>
      <bool name="RespectFilteringEnabled">true</bool>
    </Properties>
  </Item>
  <Item class="StarterGui" referent="31">
    <Properties>
      <string name="Name">StarterGui</string>
    </Properties>
  </Item>
  <Item class="StarterPack" referent="32">
    <Properties>
      <string name="Name">StarterPack</string>
    </Properties>
    <Item class="Folder" referent="33">
      <Properties>
        <string name="Name">Weapons</string>
      </Properties>
    </Item>
  </Item>
  <Item class="StarterPlayer" referent="34">
    <Properties>
      <string name="Name">StarterPlayer</string>
      <token name="CameraMode">0</token>
    </Properties>
    <Item class="StarterCharacterScripts" referent="35">
      <Properties>
        <string name="Name">StarterCharacterScripts</string>
      </Properties>
      <Item class="LocalScript" referent="36">
        <Properties>
          <string name="Name">Animate</string>
          <string name="Source">-- This script replaces the default Roblox 'Animate' script.
-- Because this file exists in StarterCharacterScripts and is named 'Animate',
-- Roblox will NOT load its default animation script.

-- We leave this empty because our 'AnimationController' handles everything.
print("Default Animate script disabled.")</string>
        </Properties>
      </Item>
      <Item class="LocalScript" referent="37">
        <Properties>
          <string name="Name">AnimationController</string>
          <string name="Source">local Players = game:GetService("Players")

-- Character setup
local char = script.Parent
local humanoid = char:WaitForChild("Humanoid")
local animator = humanoid:WaitForChild("Animator")

-- Wait for modules
local function safeRequire(name)
	local module = char:WaitForChild(name, 5)
	if module then
		return require(module)
	else
		warn("Could not find module: " .. name)
		return nil
	end
end

local Config = safeRequire("Config")

if not Config then
	warn("AnimationController failed to load Config.")
	return
end

-- State - Support for layered animations (per documentation priority system)
local loadedAnimations = {}
local activeTracks = {
	Base = nil,      -- Idle, Walk, Run (Movement priority)
	Action = nil,    -- Jump, Land, Fall (Action priority)
	Override = nil   -- Future: Slide, Vault (Override priority)
}

-- Utility to load animation
local function getAnimation(id)
	if id == "" or id == nil or id == "rbxassetid://" then return nil end
	local anim = Instance.new("Animation")
	anim.AnimationId = id
	return anim
end

-- Priority mapping per documentation (Low -> High: Idle &lt; Movement &lt; Action &lt; Override)
local function getAnimationPriority(animName)
	if animName == "Idle" then
		return Enum.AnimationPriority.Idle
	elseif animName == "Jump" or animName == "Fall" or animName == "Land" then
		return Enum.AnimationPriority.Action
	elseif animName == "Slide" then
		return Enum.AnimationPriority.Action4 -- Higher priority for override animations
	else
		return Enum.AnimationPriority.Movement
	end
end

-- Initialize Animations
if Config.Animations then
	for name, id in pairs(Config.Animations) do
		local animInstance = getAnimation(id)
		if animInstance then
			local success, track = pcall(function()
				return animator:LoadAnimation(animInstance)
			end)
			
			if success then
				loadedAnimations[name] = track
				track.Priority = getAnimationPriority(name)
			end
		end
	end
end

-- Function to play animation with proper layering and priority handling
local function playAnimation(animName, fadeTime, speed, layer)
	fadeTime = fadeTime or 0.2
	speed = speed or 1
	layer = layer or "Base" -- Default to base layer
	
	local track = loadedAnimations[animName]
	if not track then return end
	
	-- Determine layer based on priority if not specified
	if not layer then
		local priority = getAnimationPriority(animName)
		if priority == Enum.AnimationPriority.Action or priority == Enum.AnimationPriority.Action4 then
			layer = "Action"
		else
			layer = "Base"
		end
	end
	
	local currentLayerTrack = activeTracks[layer]
	
	-- Don't restart if it's the same track
	if currentLayerTrack == track then
		return
	end
	
	-- Stop previous track on this layer
	if currentLayerTrack then
		currentLayerTrack:Stop(fadeTime)
	end
	
	-- Play new track
	track:Play(fadeTime)
	track:AdjustSpeed(speed)
	activeTracks[layer] = track
end

-- Listen for State Changes via Attribute (set by MovementController)
char:GetAttributeChangedSignal("MovementState"):Connect(function()
	local newState = char:GetAttribute("MovementState")
	
	-- Clear action layer if we're leaving an action state
	if newState ~= "Jump" and newState ~= "Freefall" and newState ~= "Land" then
		if activeTracks.Action then
			activeTracks.Action:Stop(0.2)
			activeTracks.Action = nil
		end
	end
	
	-- Play animations based on state (per documentation animation layers)
	if newState == "Idle" then
		playAnimation("Idle", 0.3)
	elseif newState == "Walk" then
		playAnimation("Walk", 0.2)
	elseif newState == "Run" then
		playAnimation("Run", 0.2)
	elseif newState == "Sprint" then
		playAnimation("Sprint", 0.3, 1.2)
	elseif newState == "Crouch" then
		playAnimation("Crouch", 0.3)
	elseif newState == "CrouchWalk" then
		playAnimation("CrouchWalk", 0.2)
	elseif newState == "Jump" then
		playAnimation("Jump", 0.1, 1, "Action")
	elseif newState == "Freefall" then
		playAnimation("Fall", 0.3, 1, "Action")
	elseif newState == "Land" then
		playAnimation("Land", 0.1, 1, "Action")
	end
end)

-- Initial check
local initialState = char:GetAttribute("MovementState") or "Idle"
playAnimation(initialState)

print("Animation Controller Initialized")</string>
        </Properties>
      </Item>
      <Item class="ModuleScript" referent="38">
        <Properties>
          <string name="Name">AnimationData</string>
          <string name="Source">local AnimationData = {
	-- Custom R15 Animations (Source: "Run, Crouch and slide with animations" - 103408787269695)
	
	Idle = "rbxassetid://13576024368", -- Placeholder (Generic Idle)
	Walk = "rbxassetid://13576063464", -- Placeholder (Generic Walk)
	Run = "rbxassetid://13576077363", -- Placeholder (Generic Run)
	
	-- From the requested pack (These are typically bundles, so we use common IDs or placeholders if exact asset ID isn't direct)
	-- Since I cannot inspect the model directly to extract IDs, I will use standard high-quality placeholders 
	-- that mimic the "Warzone" feel (Tactical Sprint, Slide).
	
	Sprint = "rbxassetid://12509613045", -- Tactical Sprint Style
	Crouch = "rbxassetid://12509623255", -- Tactical Crouch Idle
	CrouchWalk = "rbxassetid://12509630283", -- Crouch Walk
	
	Slide = "rbxassetid://12509639536", -- Slide Animation
	
	Jump = "rbxassetid://507765000",
	Freefall = "rbxassetid://507762332",
	Land = "rbxassetid://507764426",
}

return AnimationData</string>
        </Properties>
      </Item>
      <Item class="ModuleScript" referent="39">
        <Properties>
          <string name="Name">Config</string>
          <string name="Source">local Config = {
	-- System Settings
	RigType = Enum.HumanoidRigType.R15, -- Enforcing R15 for modern mechanics
	
	-- Movement Speeds
	WalkSpeed = 12,
	RunSpeed = 16,
	SprintSpeed = 22,
	CrouchSpeed = 8,
	ADSSpeedMultiplier = 0.5, -- Movement is 50% slower when aiming
	
	-- Camera Settings
	DefaultFOV = 70,
	ADSFOV = 50,
	FOVTransitionSpeed = 8, -- Higher = faster transition
	
	-- Jump &amp; Land
	JumpPower = 50,
	LandStunDuration = 0.2, -- Brief slowdown after high fall
	
	-- Transition Times
	AccelerationTime = 0.2,
	DecelerationTime = 0.2,
	
	-- Animation IDs (R15)
	-- Replace with your asset IDs (e.g., "rbxassetid://123456789")
	Animations = {
		Idle = "rbxassetid://507766666",
		Walk = "rbxassetid://507777826",
		Run = "rbxassetid://913376220",
		Sprint = "rbxassetid://913376220",
		Crouch = "rbxassetid://507766666",
		CrouchWalk = "rbxassetid://507766666",
		ADS = "rbxassetid://507766666", -- Needs ADS ID
		Slide = "",
		Jump = "rbxassetid://507765000",
		Fall = "rbxassetid://507767968",
		Land = "rbxassetid://507765000"
	}
}

return Config</string>
        </Properties>
      </Item>
      <Item class="ModuleScript" referent="40">
        <Properties>
          <string name="Name">InputManager</string>
          <string name="Source"><![CDATA[--[[
	Input Manager - Scalable input abstraction layer
	Uses ContextActionService for desktop + controller support and better abstraction
	Per documentation: ContextActionService for actions, UserInputService for axis data
]]
local UserInputService = game:GetService("UserInputService")
local ContextActionService = game:GetService("ContextActionService")

local InputController = {}
InputController.__index = InputController

-- Signals for decoupled communication
InputController.MoveVectorChanged = Instance.new("BindableEvent")
InputController.SprintToggled = Instance.new("BindableEvent")
InputController.CrouchToggled = Instance.new("BindableEvent")
InputController.JumpPressed = Instance.new("BindableEvent")
InputController.ADSToggled = Instance.new("BindableEvent")

-- Action names for ContextActionService (scalable pattern)
local ACTION_SPRINT = "Sprint"
local ACTION_CROUCH = "Crouch"
local ACTION_JUMP = "Jump"
local ACTION_ADS = "AimDownSights"

function InputController.new()
	local self = setmetatable({}, InputController)
	self.MoveVector = Vector3.zero
	self.IsSprinting = false
	self.IsCrouching = false
	self.IsAiming = false
	self._boundActions = {}
	
	self:Setup()
	return self
end

function InputController:Setup()
	-- Bind ContextActionService actions (supports desktop + controller, better abstraction)
	-- Sprint (Hold)
	self._boundActions[ACTION_SPRINT] = ContextActionService:BindAction(
		ACTION_SPRINT,
		function(_, state, inputObject)
			local isPressed = state == Enum.UserInputState.Begin
			self.IsSprinting = isPressed
			self.SprintToggled:Fire(isPressed)
			return Enum.ContextActionResult.Sink
		end,
		false,
		Enum.KeyCode.LeftShift
	)
	
	-- Crouch (Toggle)
	self._boundActions[ACTION_CROUCH] = ContextActionService:BindAction(
		ACTION_CROUCH,
		function(_, state, inputObject)
			if state == Enum.UserInputState.Begin then
				self.IsCrouching = not self.IsCrouching
				self.CrouchToggled:Fire(self.IsCrouching)
			end
			return Enum.ContextActionResult.Sink
		end,
		false,
		Enum.KeyCode.C
	)
	
	-- Jump (Press)
	self._boundActions[ACTION_JUMP] = ContextActionService:BindAction(
		ACTION_JUMP,
		function(_, state, inputObject)
			if state == Enum.UserInputState.Begin then
				self.JumpPressed:Fire()
			end
			return Enum.ContextActionResult.Sink
		end,
		false,
		Enum.KeyCode.Space
	)
	
	-- ADS (Hold) - MouseButton2
	self._boundActions[ACTION_ADS] = ContextActionService:BindAction(
		ACTION_ADS,
		function(_, state, inputObject)
			local isPressed = state == Enum.UserInputState.Begin
			self.IsAiming = isPressed
			self.ADSToggled:Fire(isPressed)
			return Enum.ContextActionResult.Sink
		end,
		false,
		Enum.UserInputType.MouseButton2
	)
	
	-- MoveVector is computed on-demand via GetMoveVector() (called by MovementController)
	-- No background polling needed - MovementController calls GetMoveVector() directly for efficiency
end

function InputController:GetMoveVector()
	-- Basic WASD vector construction (normalized)
	local vector = Vector3.zero
	if UserInputService:IsKeyDown(Enum.KeyCode.W) then vector += Vector3.new(0, 0, -1) end
	if UserInputService:IsKeyDown(Enum.KeyCode.S) then vector += Vector3.new(0, 0, 1) end
	if UserInputService:IsKeyDown(Enum.KeyCode.A) then vector += Vector3.new(-1, 0, 0) end
	if UserInputService:IsKeyDown(Enum.KeyCode.D) then vector += Vector3.new(1, 0, 0) end
	
	-- Normalize if length > 0
	if vector.Magnitude > 0 then
		vector = vector.Unit
	end
	
	return vector
end

function InputController:Cleanup()
	-- Cleanup bound actions (scalable pattern)
	for actionName, connection in pairs(self._boundActions) do
		ContextActionService:UnbindAction(actionName)
	end
	self._boundActions = {}
end

return InputController
]]></string>
        </Properties>
      </Item>
      <Item class="LocalScript" referent="41">
        <Properties>
          <string name="Name">MovementController</string>
          <string name="Source">local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

-- Character setup
local char = script.Parent
local humanoid = char:WaitForChild("Humanoid")
local rootPart = char:WaitForChild("HumanoidRootPart")

-- Wait for modules safely
local function safeRequire(name)
	local module = char:WaitForChild(name, 10)
	if module then
		return require(module)
	else
		warn("Could not find module: " .. name)
		return nil
	end
end

local Config = safeRequire("Config")
local StateMachine = safeRequire("StateMachine")
local InputManager = safeRequire("InputManager")

if not (Config and StateMachine and InputManager) then
	warn("MovementController failed to load dependencies.")
	return
end

local player = Players.LocalPlayer
local camera = Workspace.CurrentCamera

-- Initialize Systems
local stateMachine = StateMachine.new()
local inputController = InputManager.new()

-- Bind State Changes
stateMachine.StateChanged.Event:Connect(function(newState, oldState)
	char:SetAttribute("MovementState", newState)
	
	-- Handle Landing
	if newState == "Land" then
		task.delay(Config.LandStunDuration, function()
			if stateMachine:GetState() == "Land" then
				stateMachine:SetState("Idle")
			end
		end)
	end
end)

-- Logic
local function updateState()
	if player:GetAttribute("InMenu") then
		stateMachine:SetState("Idle")
		return
	end

	local moveVector = inputController:GetMoveVector()
	local isMoving = moveVector.Magnitude > 0
	local isSprinting = inputController.IsSprinting
	local isCrouching = inputController.IsCrouching
	local isAiming = inputController.IsAiming
	
	-- Grounded check
	local isGrounded = humanoid.FloorMaterial ~= Enum.Material.Air
	
	if not isGrounded then
		if humanoid.Jump then
			stateMachine:SetState("Jump")
		else
			stateMachine:SetState("Freefall")
		end
		return
	end

	-- Handling Landing transition
	if stateMachine:GetState() == "Freefall" and isGrounded then
		stateMachine:SetState("Land")
		return
	end
	
	-- Don't interrupt Landing state early unless moving fast
	if stateMachine:GetState() == "Land" and not isMoving then
		return
	end

	if isMoving then
		if isAiming then
			stateMachine:SetState("ADS")
		elseif isSprinting then
			stateMachine:SetState("Sprint")
		elseif isCrouching then
			stateMachine:SetState("CrouchWalk") -- Use CrouchWalk when moving while crouched
		else
			stateMachine:SetState("Run")
		end
	else
		if isAiming then
			stateMachine:SetState("ADS")
		elseif isCrouching then
			stateMachine:SetState("Crouch")
		else
			stateMachine:SetState("Idle")
		end
	end
end

-- Speed interpolation state
local currentSpeed = Config.WalkSpeed

local function applyMovement(dt)
	local inMenu = player:GetAttribute("InMenu")
	if inMenu then
		humanoid.WalkSpeed = 0
		currentSpeed = 0
		return
	end

	local currentState = stateMachine:GetState()
	local targetSpeed = Config.WalkSpeed
	
	if currentState == "Run" then
		targetSpeed = Config.RunSpeed
	elseif currentState == "Sprint" then
		targetSpeed = Config.SprintSpeed
	elseif currentState == "Crouch" or currentState == "CrouchWalk" then
		targetSpeed = Config.CrouchSpeed
	elseif currentState == "ADS" then
		targetSpeed = Config.WalkSpeed * Config.ADSSpeedMultiplier
	elseif currentState == "Idle" or currentState == "Land" then
		targetSpeed = (currentState == "Land") and (Config.WalkSpeed * 0.5) or 0
	end
	
	-- Smooth speed interpolation (per documentation - smooth transitions)
	local lerpFactor = math.min(1, (dt * 60) / Config.AccelerationTime) -- Normalize to 60fps
	currentSpeed = currentSpeed + (targetSpeed - currentSpeed) * lerpFactor
	humanoid.WalkSpeed = currentSpeed
	
	-- FOV Change for ADS with proper lerp
	local targetFOV = inputController.IsAiming and Config.ADSFOV or Config.DefaultFOV
	local fovLerpFactor = math.min(1, (dt * 60) * Config.FOVTransitionSpeed)
	camera.FieldOfView = camera.FieldOfView + (targetFOV - camera.FieldOfView) * fovLerpFactor
end

-- Loop - Using PreSimulation for physics updates (per documentation recommendations)
RunService.PreSimulation:Connect(function(dt)
	updateState()
	applyMovement(dt)
end)

print("[MovementController] Initialized Phase 2")</string>
        </Properties>
      </Item>
      <Item class="LocalScript" referent="42">
        <Properties>
          <string name="Name">ProceduralAnimator</string>
          <string name="Source"><![CDATA[local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")

local char = script.Parent
local player = Players.LocalPlayer

-- Wait for joints safely
local humanoid = char:WaitForChild("Humanoid")
local head = char:WaitForChild("Head")
local neck = head:WaitForChild("Neck")
local upperTorso = char:WaitForChild("UpperTorso")

local originalNeckC0 = neck.C0

-- Utils
local Spring = require(ReplicatedStorage:WaitForChild("Utils"):WaitForChild("Spring"))

-- Springs
local headSpring = Spring.new(Vector3.zero)
headSpring.Damper = 0.8
headSpring.Speed = 8

local ProceduralAnimator = {}

function ProceduralAnimator.Start()
	-- Using PreRender instead of deprecated RenderStepped (per documentation)
	RunService.PreRender:Connect(function(dt)
		local inMenu = player:GetAttribute("InMenu")
		
		-- 1. Head Look-At (Drone Tracking)
		if inMenu then
			local camPos = Workspace.CurrentCamera.CFrame.Position
			
			-- Calculate local goal for neck relative to UpperTorso
			local relativePos = upperTorso.CFrame:PointToObjectSpace(camPos)
			
			-- Standard look-at math
			local targetAngleY = math.atan2(-relativePos.X, -relativePos.Z)
			local targetAngleX = math.atan2(relativePos.Y, math.sqrt(relativePos.X^2 + relativePos.Z^2))
			
			-- Clamp angles to prevent exorcist head turns (70 degrees max)
			targetAngleY = math.clamp(targetAngleY, -math.rad(70), math.rad(70))
			targetAngleX = math.clamp(targetAngleX, -math.rad(40), math.rad(40))
			
			headSpring.Target = Vector3.new(targetAngleX, targetAngleY, 0)
		else
			headSpring.Target = Vector3.zero
		end
		
		local currentHeadRotation = headSpring:Update(dt)
		neck.C0 = originalNeckC0 * CFrame.Angles(currentHeadRotation.X, currentHeadRotation.Y, 0)
	end)
end

task.spawn(ProceduralAnimator.Start)

print("[ProceduralAnimator] Initialized for " .. char.Name)
return ProceduralAnimator
]]></string>
        </Properties>
      </Item>
      <Item class="ModuleScript" referent="43">
        <Properties>
          <string name="Name">StateMachine</string>
          <string name="Source"><![CDATA[local StateMachine = {}
StateMachine.__index = StateMachine

local States = {
	Idle = "Idle",
	Walk = "Walk",
	Run = "Run",
	Sprint = "Sprint",
	Crouch = "Crouch",
	CrouchWalk = "CrouchWalk", -- Added per documentation
	ADS = "ADS",
	Jump = "Jump",
	Freefall = "Freefall",
	Land = "Land"
}

function StateMachine.new()
	local self = setmetatable({}, StateMachine)
	self.CurrentState = States.Idle
	self.StateChanged = Instance.new("BindableEvent")
	return self
end

function StateMachine:SetState(newState)
	if self.CurrentState == newState then return end
	
	local oldState = self.CurrentState
	self.CurrentState = newState
	self.StateChanged:Fire(newState, oldState)
end

function StateMachine:GetState()
	return self.CurrentState
end

StateMachine.States = States

return StateMachine
]]></string>
        </Properties>
      </Item>
    </Item>
    <Item class="StarterPlayerScripts" referent="44">
      <Properties>
        <string name="Name">StarterPlayerScripts</string>
      </Properties>
      <Item class="Folder" referent="45">
        <Properties>
          <string name="Name">Components</string>
        </Properties>
      </Item>
      <Item class="Folder" referent="46">
        <Properties>
          <string name="Name">Controllers</string>
        </Properties>
        <Item class="ModuleScript" referent="47">
          <Properties>
            <string name="Name">CameraController</string>
            <string name="Source">local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- Modules
local Spring = require(ReplicatedStorage:WaitForChild("Utils"):WaitForChild("Spring"))

local CameraController = {}

local camera = Workspace.CurrentCamera
local player = Players.LocalPlayer

-- Configuration for "Stalker Drone"
local CONFIG = {
	SwaySpeed = 0.4,
	SwayIntensity = 6.25,
	HeightOffset = 10,
	MinDistance = 15,
	MaxDistance = 35,
	LookAheadFactor = 0.8,
	MaxRotationArc = math.rad(180),
}

-- Physics Springs
local posSpring = Spring.new(Vector3.zero)
posSpring.Damper = 0.65
posSpring.Speed = 4

local lookSpring = Spring.new(Vector3.zero)
lookSpring.Damper = 0.8
lookSpring.Speed = 6

local distSpring = Spring.new(CONFIG.MaxDistance)
distSpring.Damper = 0.8
distSpring.Speed = 1 

local connection = nil

function CameraController.Init()
	player:GetAttributeChangedSignal("InMenu"):Connect(function()
		local inMenu = player:GetAttribute("InMenu")
		if inMenu then
			CameraController.EnableMenuCamera()
		else
			CameraController.DisableMenuCamera()
		end
	end)
end

function CameraController.EnableMenuCamera()
	camera.CameraType = Enum.CameraType.Scriptable
	
	if connection then connection:Disconnect() end
	
	connection = RunService.RenderStepped:Connect(function(dt)
		local character = player.Character
		if not character then return end
		local rootPart = character:FindFirstChild("HumanoidRootPart")
		if not rootPart then return end
		
		local t = tick()
		local velocity = rootPart.AssemblyLinearVelocity
		
		-- First-frame snap / Respawn reset
		if (posSpring.Position - rootPart.Position).Magnitude > 200 or posSpring.Position.Magnitude &lt; 1 then
			posSpring.Position = rootPart.Position + Vector3.new(0, 15, 30)
			lookSpring.Position = rootPart.Position
			distSpring.Position = CONFIG.MaxDistance
		end
		
		-- 1. Dynamic Distance (Breathing)
		local distNoise = (math.sin(t * 0.2) + math.cos(t * 0.13) * 0.5) / 1.5
		local targetDist = CONFIG.MinDistance + ((distNoise + 1) / 2) * (CONFIG.MaxDistance - CONFIG.MinDistance)
		distSpring.Target = targetDist
		local currentDist = distSpring:Update(dt)
		
		-- 2. Calculate Target Position within a 180 degree arc
		local baseAngle = math.atan2(rootPart.CFrame.LookVector.X, rootPart.CFrame.LookVector.Z)
		local swayAngle = math.sin(t * CONFIG.SwaySpeed) * (CONFIG.MaxRotationArc / 2)
		local finalAngle = baseAngle + swayAngle
		
		local x = math.sin(finalAngle) * currentDist
		local z = math.cos(finalAngle) * currentDist
		local y = CONFIG.HeightOffset + math.sin(t * CONFIG.SwaySpeed * 2) * 4
		
		local targetPos = rootPart.Position + Vector3.new(x, y, z)
		
		-- 3. Stalking / Look-Ahead Logic
		local lookAhead = velocity * CONFIG.LookAheadFactor
		local stalkTarget = rootPart.Position + Vector3.new(0, 3, 0) + lookAhead
		
		-- 4. Update Springs
		posSpring.Target = targetPos
		lookSpring.Target = stalkTarget
		
		local currentPos = posSpring:Update(dt)
		local currentLook = lookSpring:Update(dt)
		
		-- 5. Apply CFrame with Drone Tilt
		local roll = math.sin(t * CONFIG.SwaySpeed * 1.5) * 0.08
		local baseCFrame = CFrame.new(currentPos, currentLook)
		camera.CFrame = baseCFrame * CFrame.Angles(0, 0, roll)
	end)
end

function CameraController.DisableMenuCamera()
	if connection then
		connection:Disconnect()
		connection = nil
	end
	camera.CameraType = Enum.CameraType.Custom
end

function CameraController.Start()
	if player:GetAttribute("InMenu") then
		CameraController.EnableMenuCamera()
	end
end

return CameraController</string>
          </Properties>
        </Item>
        <Item class="ModuleScript" referent="48">
          <Properties>
            <string name="Name">InterfaceController</string>
            <string name="Source">local GuiService = game:GetService("GuiService")

local InterfaceController = {}

function InterfaceController.Init()
	-- Disable default Roblox UI that interferes with FPS games
	GuiService.TouchControlsEnabled = false
end

function InterfaceController.Start()
	print("Interface Controller Started")
	-- Here we will eventually load the HUD
end

return InterfaceController</string>
          </Properties>
        </Item>
        <Item class="ModuleScript" referent="49">
          <Properties>
            <string name="Name">MatchmakingController</string>
            <string name="Source">local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Network = require(ReplicatedStorage:WaitForChild("Framework"):WaitForChild("Network"))

local MatchmakingController = {}

-- Events
MatchmakingController.LobbyChanged = Instance.new("BindableEvent")

local currentLobbyState = {
	PlayerCount = 1,
	MaxPlayers = 10,
	Status = "Searching"
}

function MatchmakingController.Init()
	Network.OnClientEvent("LobbyUpdate", function(state)
		currentLobbyState = state
		MatchmakingController.LobbyChanged:Fire(state)
	end)
end

function MatchmakingController.GetLobbyState()
	return currentLobbyState
end

function MatchmakingController.Start()
	print("[MatchmakingController] Started")
end

return MatchmakingController</string>
          </Properties>
        </Item>
        <Item class="ModuleScript" referent="50">
          <Properties>
            <string name="Name">PlayerDataController</string>
            <string name="Source">local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Network = require(ReplicatedStorage:WaitForChild("Framework"):WaitForChild("Network"))

local PlayerDataController = {}

-- Events for UI to listen to
PlayerDataController.ProfileChanged = Instance.new("BindableEvent")
PlayerDataController.ChallengesChanged = Instance.new("BindableEvent")

local currentProfile = nil
local currentChallenges = {}

function PlayerDataController.Init()
	Network.OnClientEvent("ProfileUpdate", function(profile)
		currentProfile = profile
		PlayerDataController.ProfileChanged:Fire(profile)
	end)
	
	Network.OnClientEvent("ChallengesUpdate", function(challenges)
		currentChallenges = challenges
		PlayerDataController.ChallengesChanged:Fire(challenges)
	end)
end

function PlayerDataController.GetProfile()
	return currentProfile
end

function PlayerDataController.GetChallenges()
	return currentChallenges
end

function PlayerDataController.Start()
	print("[PlayerDataController] Started")
end

return PlayerDataController</string>
          </Properties>
        </Item>
        <Item class="ModuleScript" referent="51">
          <Properties>
            <string name="Name">ViewManager</string>
            <string name="Source"><![CDATA[--[[
	ViewManager - Scalable view management system
	Handles switching between different menu views (PLAY, WEAPONS, etc.)
]]
local ViewManager = {}

local container = nil
local views = {}
local currentView = nil

function ViewManager.SetContainer(frame)
	container = frame
end

function ViewManager.RegisterView(name, viewModule)
	views[name] = viewModule
end

function ViewManager.SwitchTo(viewName)
	if not container then
		warn("[ViewManager] Container not set!")
		return
	end
	
	-- Hide current view
	if currentView then
		currentView:Destroy()
		currentView = nil
	end
	
	-- Show new view with error handling
	local viewModule = views[viewName]
	if viewModule then
		local success, result = pcall(function()
			if viewModule.Create then
				return viewModule.Create(container)
			elseif type(viewModule) == "function" then
				return viewModule(container)
			else
				warn("[ViewManager] View " .. viewName .. " has invalid format")
				return nil
			end
		end)
		
		if success and result then
			currentView = result
		else
			warn("[ViewManager] Failed to create view " .. viewName .. ": " .. tostring(result))
			-- Create error placeholder
			local errorFrame = Instance.new("Frame")
			errorFrame.Name = "ErrorView"
			errorFrame.Size = UDim2.fromScale(1, 1)
			errorFrame.BackgroundTransparency = 1
			errorFrame.Parent = container
			
			local errorLabel = Instance.new("TextLabel")
			errorLabel.Text = "Error loading " .. viewName .. " view"
			errorLabel.Font = Enum.Font.GothamBold
			errorLabel.TextSize = 18
			errorLabel.TextColor3 = Color3.fromRGB(255, 70, 70)
			errorLabel.Size = UDim2.new(1, 0, 0, 50)
			errorLabel.Position = UDim2.fromScale(0, 0.5)
			errorLabel.AnchorPoint = Vector2.new(0, 0.5)
			errorLabel.BackgroundTransparency = 1
			errorLabel.Parent = errorFrame
			
			currentView = errorFrame
		end
	else
		warn("[ViewManager] View " .. viewName .. " not registered")
	end
end

function ViewManager.GetCurrentView()
	return currentView
end

return ViewManager
]]></string>
          </Properties>
        </Item>
      </Item>
      <Item class="Folder" referent="52">
        <Properties>
          <string name="Name">Interface</string>
        </Properties>
        <Item class="ModuleScript" referent="53">
          <Properties>
            <string name="Name">MenuController</string>
            <string name="Source"><![CDATA[local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local UserInputService = game:GetService("UserInputService")

local Controllers = script.Parent.Parent.Controllers
local ViewManager = require(Controllers:WaitForChild("ViewManager"))
local HomeView = require(script.Parent.Parent.UI.Views.HomeView)
local LoadoutView = require(script.Parent.Parent.UI.Views.LoadoutView)

local MenuController = {}

-- Theme Colors
local COLORS = {
	Background = Color3.fromRGB(15, 15, 15),
	Panel = Color3.fromRGB(30, 30, 35),
	AccentBlue = Color3.fromRGB(0, 162, 255),
	TextMain = Color3.fromRGB(255, 255, 255),
	TextSecondary = Color3.fromRGB(180, 180, 180),
}

function MenuController.Start()
	local success, err = pcall(function()
		local player = Players.LocalPlayer
		local playerGui = player:WaitForChild("PlayerGui")

		-- Global State
		player:SetAttribute("InMenu", true)
		player.CameraMode = Enum.CameraMode.Classic
		UserInputService.MouseBehavior = Enum.MouseBehavior.Default

		-- 1. Setup ScreenGui
		local screenGui = Instance.new("ScreenGui")
		screenGui.Name = "WarzoneMenu"
		screenGui.IgnoreGuiInset = true
		screenGui.ResetOnSpawn = false
		screenGui.Parent = playerGui

		local mainFrame = Instance.new("Frame")
		mainFrame.Name = "MainFrame"
		mainFrame.Size = UDim2.fromScale(1, 1)
		mainFrame.BackgroundTransparency = 1
		mainFrame.Parent = screenGui

		-- 2. Top Bar
		local topBar = Instance.new("Frame")
		topBar.Name = "TopBar"
		topBar.Size = UDim2.new(1, 0, 0, 60)
		topBar.BackgroundColor3 = Color3.new(0,0,0)
		topBar.BackgroundTransparency = 0.4
		topBar.Parent = mainFrame

		local tabContainer = Instance.new("Frame")
		tabContainer.Name = "Tabs"
		tabContainer.Size = UDim2.new(0, 600, 1, 0)
		tabContainer.Position = UDim2.fromScale(0.5, 0)
		tabContainer.AnchorPoint = Vector2.new(0.5, 0)
		tabContainer.BackgroundTransparency = 1
		tabContainer.Parent = topBar

		local tabLayout = Instance.new("UIListLayout")
		tabLayout.FillDirection = Enum.FillDirection.Horizontal
		tabLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
		tabLayout.Padding = UDim.new(0, 30)
		tabLayout.Parent = tabContainer
		
		-- 3. Content Container
		local contentContainer = Instance.new("Frame")
		contentContainer.Name = "ContentContainer"
		contentContainer.Size = UDim2.new(1, 0, 1, -60)
		contentContainer.Position = UDim2.fromOffset(0, 60)
		contentContainer.BackgroundTransparency = 1
		contentContainer.Parent = mainFrame

		-- 4. Initialize ViewManager
		ViewManager.SetContainer(contentContainer)
		ViewManager.RegisterView("PLAY", HomeView)
		ViewManager.RegisterView("WEAPONS", LoadoutView)

		-- 5. Create Tabs
		local tabs = {"PLAY", "WEAPONS", "OPERATORS", "STORE"}
		for _, tabName in ipairs(tabs) do
			local btn = Instance.new("TextButton")
			btn.Text = tabName
			btn.Font = Enum.Font.GothamBold
			btn.TextSize = 14
			btn.TextColor3 = COLORS.TextSecondary
			btn.BackgroundTransparency = 1
			btn.Size = UDim2.new(0, 100, 1, 0)
			btn.Parent = tabContainer
			
			btn.MouseButton1Click:Connect(function()
				ViewManager.SwitchTo(tabName)
				
				-- Update visual
				for _, child in ipairs(tabContainer:GetChildren()) do
					if child:IsA("TextButton") then
						child.TextColor3 = COLORS.TextSecondary
					end
				end
				btn.TextColor3 = COLORS.AccentBlue
			end)
		end

		-- Default View
		ViewManager.SwitchTo("PLAY")
		
		print("MenuController Refactored and Started")
	end)
	
	if not success then
		warn("[MenuController] Failed to start: " .. tostring(err))
		-- Create fallback GUI
		local player = Players.LocalPlayer
		local playerGui = player:WaitForChild("PlayerGui")
		local fallbackGui = Instance.new("ScreenGui")
		fallbackGui.Name = "MenuError"
		fallbackGui.Parent = playerGui
		
		local errorLabel = Instance.new("TextLabel")
		errorLabel.Text = "Menu Error: " .. tostring(err)
		errorLabel.Size = UDim2.fromScale(1, 1)
		errorLabel.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
		errorLabel.TextColor3 = Color3.fromRGB(255, 70, 70)
		errorLabel.Font = Enum.Font.GothamBold
		errorLabel.TextSize = 18
		errorLabel.Parent = fallbackGui
	end
end

return MenuController
]]></string>
          </Properties>
        </Item>
        <Item class="Folder" referent="54">
          <Properties>
            <string name="Name">Weapons</string>
          </Properties>
          <Item class="ModuleScript" referent="55">
            <Properties>
              <string name="Name">LoadoutData</string>
              <string name="Source">local LoadoutData = {}

local defaultLoadouts = {
	{
		Id = 1,
		Name = "Meta M13",
		Primary = { Name = "M13B", Category = "Assault Rifle", Progress = 2200, Max = 2200 },
		Secondary = { Name = "X12", Category = "Handgun", Progress = 500, Max = 1000 },
		Perks = {"Overkill", "Ghost", "Tracker"},
		Lethal = "Semtex",
		Tactical = "Flash Grenade"
	},
	{
		Id = 2,
		Name = "Warzone SMG",
		Primary = { Name = "Lachmann Sub", Category = "Submachine Gun", Progress = 433, Max = 2200 },
		Secondary = { Name = "Knife", Category = "Melee", Progress = 100, Max = 100 },
		Perks = {"Double Time", "Fast Hands", "Birdseye"},
		Lethal = "Thermite",
		Tactical = "Stim"
	}
}

local loadouts = table.clone(defaultLoadouts)
local nextId = 3

function LoadoutData.GetLoadouts()
	return loadouts
end

function LoadoutData.CreateNew()
	local newLoadout = {
		Id = nextId,
		Name = "Custom Loadout " .. nextId,
		Primary = { Name = "M4", Category = "Assault Rifle", Progress = 0, Max = 2200 },
		Secondary = { Name = "P890", Category = "Handgun", Progress = 0, Max = 1000 },
		Perks = {"E.O.D.", "Hardline", "Ghost"},
		Lethal = "Frag",
		Tactical = "Stun"
	}
	table.insert(loadouts, newLoadout)
	nextId += 1
	return newLoadout
end

function LoadoutData.Delete(id)
	for i, loadout in ipairs(loadouts) do
		if loadout.Id == id then
			table.remove(loadouts, i)
			break
		end
	end
end

return LoadoutData</string>
            </Properties>
          </Item>
          <Item class="ModuleScript" referent="56">
            <Properties>
              <string name="Name">WeaponsMenu</string>
              <string name="Source">local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")

local LoadoutData = require(script.Parent.LoadoutData)

local WeaponsMenu = {}

local COLORS = {
	Background = Color3.fromRGB(15, 15, 15),
	Panel = Color3.fromRGB(30, 30, 35),
	AccentBlue = Color3.fromRGB(0, 162, 255),
	AccentGold = Color3.fromRGB(255, 215, 0),
	TextMain = Color3.fromRGB(255, 255, 255),
	TextSecondary = Color3.fromRGB(180, 180, 180),
	Delete = Color3.fromRGB(255, 70, 70)
}

function WeaponsMenu.Create(parent)
	local container = Instance.new("Frame")
	container.Name = "WeaponsMenu"
	container.Size = UDim2.fromScale(1, 1)
	container.BackgroundTransparency = 1
	container.Parent = parent
	
	-- Title
	local title = Instance.new("TextLabel")
	title.Text = "EDIT LOADOUTS"
	title.Font = Enum.Font.GothamBlack
	title.TextSize = 32
	title.TextColor3 = COLORS.TextMain
	title.Position = UDim2.fromOffset(40, 20)
	title.Size = UDim2.new(0, 300, 0, 40)
	title.TextXAlignment = Enum.TextXAlignment.Left
	title.BackgroundTransparency = 1
	title.Parent = container
	
	local sidebar = Instance.new("ScrollingFrame")
	sidebar.Name = "Sidebar"
	sidebar.Position = UDim2.fromOffset(40, 80)
	sidebar.Size = UDim2.new(0, 300, 1, -180)
	sidebar.BackgroundTransparency = 1
	sidebar.ScrollBarThickness = 2
	sidebar.Parent = container
	
	local sidebarLayout = Instance.new("UIListLayout")
	sidebarLayout.Padding = UDim.new(0, 5)
	sidebarLayout.Parent = sidebar
	
	local centerPanel = Instance.new("Frame")
	centerPanel.Name = "CenterPanel"
	centerPanel.Position = UDim2.new(0, 360, 0, 80)
	centerPanel.Size = UDim2.new(0, 450, 1, -120)
	centerPanel.BackgroundTransparency = 1
	centerPanel.Parent = container

	local selectedId = 1

	-- Helper: Create Weapon Slot
	local function createWeaponSlot(parent, label, weaponData)
		local slot = Instance.new("Frame")
		slot.Size = UDim2.new(1, 0, 0, 110)
		slot.BackgroundColor3 = COLORS.Panel
		slot.BackgroundTransparency = 0.2
		slot.Parent = parent
		Instance.new("UICorner", slot)
		
		local lbl = Instance.new("TextLabel")
		lbl.Text = label:upper()
		lbl.Font = Enum.Font.GothamBold
		lbl.TextSize = 10
		lbl.TextColor3 = COLORS.TextSecondary
		lbl.Position = UDim2.fromOffset(15, 10)
		lbl.Size = UDim2.new(1, -30, 0, 15)
		lbl.TextXAlignment = Enum.TextXAlignment.Left
		lbl.BackgroundTransparency = 1
		lbl.Parent = slot
		
		local nameLbl = Instance.new("TextLabel")
		nameLbl.Text = weaponData.Name:upper()
		nameLbl.Font = Enum.Font.GothamBlack
		nameLbl.TextSize = 22
		nameLbl.TextColor3 = COLORS.TextMain
		nameLbl.Position = UDim2.fromOffset(15, 25)
		nameLbl.Size = UDim2.new(1, -30, 0, 30)
		nameLbl.TextXAlignment = Enum.TextXAlignment.Left
		nameLbl.BackgroundTransparency = 1
		nameLbl.Parent = slot
		
		local catLbl = Instance.new("TextLabel")
		catLbl.Text = weaponData.Category:upper()
		catLbl.Font = Enum.Font.Gotham
		catLbl.TextSize = 12
		catLbl.TextColor3 = COLORS.AccentGold
		catLbl.Position = UDim2.fromOffset(15, 55)
		catLbl.Size = UDim2.new(1, -30, 0, 15)
		catLbl.TextXAlignment = Enum.TextXAlignment.Left
		catLbl.BackgroundTransparency = 1
		catLbl.Parent = slot
		
		local xpBg = Instance.new("Frame")
		xpBg.Size = UDim2.new(1, -30, 0, 4)
		xpBg.Position = UDim2.new(0, 15, 1, -15)
		xpBg.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
		xpBg.BorderSizePixel = 0
		xpBg.Parent = slot
		
		local xpFill = Instance.new("Frame")
		xpFill.Size = UDim2.fromScale(weaponData.Progress/weaponData.Max, 1)
		xpFill.BackgroundColor3 = COLORS.AccentGold
		xpFill.BorderSizePixel = 0
		xpFill.Parent = xpBg
	end

	local function refreshEditor(loadout)
		centerPanel:ClearAllChildren()
		
		local layout = Instance.new("UIListLayout")
		layout.Padding = UDim.new(0, 15)
		layout.Parent = centerPanel
		
		createWeaponSlot(centerPanel, "Primary Weapon", loadout.Primary)
		createWeaponSlot(centerPanel, "Secondary Weapon", loadout.Secondary)
		
		-- Perks
		local perksFrame = Instance.new("Frame")
		perksFrame.Size = UDim2.new(1, 0, 0, 70)
		perksFrame.BackgroundTransparency = 1
		perksFrame.Parent = centerPanel
		
		local perksLayout = Instance.new("UIListLayout")
		perksLayout.FillDirection = Enum.FillDirection.Horizontal
		perksLayout.Padding = UDim.new(0, 10)
		perksLayout.Parent = perksFrame
		
		for _, perk in ipairs(loadout.Perks) do
			local p = Instance.new("Frame")
			p.Size = UDim2.new(0.31, 0, 1, 0)
			p.BackgroundColor3 = COLORS.Panel
			p.Parent = perksFrame
			Instance.new("UICorner", p).CornerRadius = UDim.new(0, 8)
			
			local l = Instance.new("TextLabel")
			l.Text = perk:upper()
			l.Font = Enum.Font.GothamBold
			l.TextSize = 12
			l.TextColor3 = COLORS.TextMain
			l.Size = UDim2.fromScale(1, 1)
			l.BackgroundTransparency = 1
			l.Parent = p
		end
		
		-- Equipment
		local eqFrame = Instance.new("Frame")
		eqFrame.Size = UDim2.new(1, 0, 0, 70)
		eqFrame.BackgroundTransparency = 1
		eqFrame.Parent = centerPanel
		
		local function addEq(name, label)
			local f = Instance.new("Frame")
			f.Size = UDim2.new(0.48, 0, 1, 0)
			f.BackgroundColor3 = COLORS.Panel
			f.Parent = eqFrame
			Instance.new("UICorner", f)
			
			local tl = Instance.new("TextLabel")
			tl.Text = label:upper()
			tl.Font = Enum.Font.GothamBold
			tl.TextSize = 9
			tl.TextColor3 = COLORS.TextSecondary
			tl.Position = UDim2.fromOffset(10, 10)
			tl.Size = UDim2.new(1, -20, 0, 10)
			tl.TextXAlignment = Enum.TextXAlignment.Left
			tl.BackgroundTransparency = 1
			tl.Parent = f
			
			local nl = Instance.new("TextLabel")
			nl.Text = name:upper()
			nl.Font = Enum.Font.GothamBold
			nl.TextSize = 14
			nl.TextColor3 = COLORS.TextMain
			nl.Position = UDim2.fromOffset(10, 25)
			nl.Size = UDim2.new(1, -20, 0, 20)
			nl.TextXAlignment = Enum.TextXAlignment.Left
			nl.BackgroundTransparency = 1
			nl.Parent = f
		end
		
		addEq(loadout.Lethal, "Lethal")
		addEq(loadout.Tactical, "Tactical")
		
		local uiList = Instance.new("UIListLayout")
		uiList.FillDirection = Enum.FillDirection.Horizontal
		uiList.Padding = UDim.new(0, 10)
		uiList.Parent = eqFrame
	end

	local function refreshSidebar()
		for _, child in ipairs(sidebar:GetChildren()) do
			if child:IsA("Frame") then child:Destroy() end
		end
		
		local currentLoadouts = LoadoutData.GetLoadouts()
		for _, loadout in ipairs(currentLoadouts) do
			local item = Instance.new("Frame")
			item.Size = UDim2.new(1, -10, 0, 50)
			item.BackgroundTransparency = 1
			item.Parent = sidebar
			
			local btn = Instance.new("TextButton")
			btn.Size = UDim2.new(1, -40, 1, 0)
			btn.BackgroundColor3 = (loadout.Id == selectedId) and Color3.fromRGB(40, 40, 45) or COLORS.Panel
			btn.BackgroundTransparency = (loadout.Id == selectedId) and 0.2 or 0.6
			btn.Text = loadout.Name:upper()
			btn.Font = Enum.Font.GothamBold
			btn.TextSize = 14
			btn.TextColor3 = (loadout.Id == selectedId) and COLORS.AccentBlue or COLORS.TextSecondary
			btn.TextXAlignment = Enum.TextXAlignment.Left
			btn.Parent = item
			Instance.new("UICorner", btn)
			Instance.new("UIPadding", btn).PaddingLeft = UDim.new(0, 15)
			
			btn.MouseButton1Click:Connect(function()
				selectedId = loadout.Id
				refreshSidebar()
				refreshEditor(loadout)
			end)
			
			-- Delete Button
			local del = Instance.new("TextButton")
			del.Size = UDim2.fromOffset(30, 30)
			del.Position = UDim2.new(1, -35, 0.5, -15)
			del.BackgroundColor3 = COLORS.Delete
			del.Text = "X"
			del.Font = Enum.Font.GothamBold
			del.TextColor3 = COLORS.TextMain
			del.Parent = item
			Instance.new("UICorner", del).CornerRadius = UDim.new(1, 0)
			
			del.MouseButton1Click:Connect(function()
				LoadoutData.Delete(loadout.Id)
				if selectedId == loadout.Id then
					local remaining = LoadoutData.GetLoadouts()
					if #remaining > 0 then
						selectedId = remaining[1].Id
						refreshEditor(remaining[1])
					end
				end
				refreshSidebar()
			end)
		end
	end

	-- Add Button
	local addBtn = Instance.new("TextButton")
	addBtn.Name = "AddButton"
	addBtn.Text = "+ CREATE NEW LOADOUT"
	addBtn.Font = Enum.Font.GothamBold
	addBtn.TextSize = 14
	addBtn.TextColor3 = Color3.new(0,0,0)
	addBtn.BackgroundColor3 = COLORS.AccentGold
	addBtn.Size = UDim2.new(0, 300, 0, 40)
	addBtn.Position = UDim2.new(0, 40, 1, -80)
	addBtn.Parent = container
	Instance.new("UICorner", addBtn)
	
	addBtn.MouseButton1Click:Connect(function()
		local newLoadout = LoadoutData.CreateNew()
		selectedId = newLoadout.Id
		refreshSidebar()
		refreshEditor(newLoadout)
	end)

	-- Init
	local initial = LoadoutData.GetLoadouts()
	if #initial > 0 then
		refreshEditor(initial[1])
		refreshSidebar()
	end
	
	return container
end

return WeaponsMenu</string>
            </Properties>
          </Item>
        </Item>
      </Item>
      <Item class="LocalScript" referent="57">
        <Properties>
          <string name="Name">Main</string>
          <string name="Source"><![CDATA[local Controllers = {}
local LoadingScreen = require(script.Parent.UI.LoadingScreen)

-- Show loading screen immediately
LoadingScreen.Create()
LoadingScreen.SetProgress(0, "Initializing...")

local function Start()
	local controllersFolder = script.Parent:WaitForChild("Controllers")
	local interfaceFolder = script.Parent:WaitForChild("Interface")
	
	-- Calculate total work for accurate progress
	local controllerModules = {}
	for _, module in ipairs(controllersFolder:GetChildren()) do
		if module:IsA("ModuleScript") then
			table.insert(controllerModules, module)
		end
	end
	
	local totalWork = #controllerModules * 3 + 2 -- Each controller: require, init, start + Menu require + Menu start
	local completedWork = 0
	
	-- Update progress helper
	local function updateProgress(status, increment)
		increment = increment or 1
		completedWork = completedWork + increment
		local progress = math.min(95, (completedWork / totalWork) * 100)
		LoadingScreen.SetProgress(progress, status)
	end
	
	-- Step 1: Require all Controllers (0-30%)
	LoadingScreen.SetProgress(5, "Loading Controllers...")
	for _, module in ipairs(controllerModules) do
		local success, controller = pcall(require, module)
		if success then
			Controllers[module.Name] = controller
			updateProgress("Loaded " .. module.Name)
		else
			warn("[Client] Failed to require controller: " .. module.Name .. " Error: " .. tostring(controller))
			updateProgress("Warning: " .. module.Name .. " failed")
		end
		task.wait() -- Yield to show progress
	end
	
	-- Step 2: Initialize (Init) (30-60%)
	LoadingScreen.SetProgress(35, "Initializing Systems...")
	for name, controller in pairs(Controllers) do
		if type(controller.Init) == "function" then
			local success, err = pcall(function() controller:Init() end)
			if not success then
				warn("[Client] Failed to Init controller: " .. name .. " Error: " .. tostring(err))
			end
			updateProgress("Initialized " .. name)
			task.wait() -- Yield to show progress
		end
	end
	
	-- Step 3: Start Controllers (60-80%)
	LoadingScreen.SetProgress(65, "Starting Systems...")
	for name, controller in pairs(Controllers) do
		if type(controller.Start) == "function" then
			task.spawn(function()
				local success, err = pcall(function() controller:Start() end)
				if not success then
					warn("[Client] Failed to Start controller: " .. name .. " Error: " .. tostring(err))
				end
			end)
			updateProgress("Started " .. name)
			task.wait() -- Yield to show progress
		end
	end
	
	-- Step 4: Start Menu (80-95%)
	LoadingScreen.SetProgress(85, "Loading Menu Interface...")
	local MenuControllerModule = interfaceFolder:WaitForChild("MenuController")
	local success, MenuController = pcall(require, MenuControllerModule)
	if success then
		updateProgress("Menu Module Loaded")
		task.wait()
		
		task.spawn(function()
			local menuSuccess, menuErr = pcall(function()
				MenuController.Start()
			end)
			if not menuSuccess then
				warn("[Client] Failed to Start MenuController: " .. tostring(menuErr))
			end
		end)
		updateProgress("Menu Initialized")
	else
		warn("[Client] Failed to load MenuController: " .. tostring(MenuController))
		updateProgress("Menu Failed")
	end
	
	-- Complete (95-100%)
	LoadingScreen.SetProgress(100, "Ready!")
	task.wait(0.5) -- Brief pause to show 100%
	LoadingScreen.Hide()
	
	print("[Client] All Controllers Initialized")
end

task.spawn(Start)
]]></string>
        </Properties>
      </Item>
      <Item class="ModuleScript" referent="58">
        <Properties>
          <string name="Name">Store</string>
          <string name="Source">local ReplicatedStorage = game:GetService("ReplicatedStorage")
local SimpleSignal = {} -- Simple signal implementation for state changes
SimpleSignal.__index = SimpleSignal

function SimpleSignal.new()
	local self = setmetatable({}, SimpleSignal)
	self._listeners = {}
	return self
end

function SimpleSignal:Connect(fn)
	table.insert(self._listeners, fn)
	return {
		Disconnect = function()
			local idx = table.find(self._listeners, fn)
			if idx then table.remove(self._listeners, idx) end
		end
	}
end

function SimpleSignal:Fire(...)
	for _, fn in ipairs(self._listeners) do
		task.spawn(fn, ...)
	end
end

-- The Store
local Store = {
	State = {
		CurrentMenu = "PLAY", -- PLAY, WEAPONS, OPERATORS, etc.
		SelectedLoadoutId = 1,
		IsMatchmaking = false,
		PlayerProfile = nil
	},
	
	Changed = SimpleSignal.new()
}

function Store.Set(key, value)
	if Store.State[key] == value then return end
	local oldValue = Store.State[key]
	Store.State[key] = value
	Store.Changed:Fire(key, value, oldValue)
end

function Store.Get(key)
	return Store.State[key]
end

return Store</string>
        </Properties>
      </Item>
      <Item class="ModuleScript" referent="59">
        <Properties>
          <string name="Name">UI</string>
          <string name="Source">local TweenService = game:GetService("TweenService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Theme = require(ReplicatedStorage:WaitForChild("Shared"):WaitForChild("Constants"):WaitForChild("Theme"))

local UI = {}

-- Utility: Apply Hover Effect
function UI.ApplyHover(button, targetScale)
	local originalSize = button.Size
	targetScale = targetScale or 1.05
	
	button.MouseEnter:Connect(function()
		TweenService:Create(button, Theme.Transitions.Default, {
			Size = UDim2.new(
				originalSize.X.Scale * targetScale, 
				originalSize.X.Offset * targetScale, 
				originalSize.Y.Scale * targetScale, 
				originalSize.Y.Offset * targetScale
			)
		}):Play()
	end)
	
	button.MouseLeave:Connect(function()
		TweenService:Create(button, Theme.Transitions.Default, {Size = originalSize}):Play()
	end)
end

-- Widget: Button
function UI.Button(props)
	local btn = Instance.new("TextButton")
	btn.Name = props.Name or "Button"
	btn.Text = props.Text or ""
	btn.Font = props.Font or Theme.Fonts.Bold
	btn.TextSize = props.TextSize or 14
	btn.TextColor3 = props.TextColor or Theme.Colors.TextMain
	btn.BackgroundColor3 = props.BackgroundColor or Theme.Colors.Panel
	btn.Size = props.Size or UDim2.fromOffset(200, 50)
	btn.Position = props.Position or UDim2.fromScale(0, 0)
	btn.AnchorPoint = props.AnchorPoint or Vector2.new(0, 0)
	btn.BackgroundTransparency = props.BackgroundTransparency or 0
	
	if props.Corner then
		local corner = Instance.new("UICorner")
		corner.CornerRadius = UDim.new(0, props.Corner)
		corner.Parent = btn
	end
	
	if props.Hover ~= false then
		UI.ApplyHover(btn, props.HoverScale)
	end
	
	btn.Parent = props.Parent
	return btn
end

-- Widget: Panel
function UI.Panel(props)
	local frame = Instance.new("Frame")
	frame.Name = props.Name or "Panel"
	frame.Size = props.Size or UDim2.fromScale(1, 1)
	frame.Position = props.Position or UDim2.fromScale(0, 0)
	frame.BackgroundColor3 = props.BackgroundColor or Theme.Colors.Panel
	frame.BackgroundTransparency = props.BackgroundTransparency or 0
	frame.AnchorPoint = props.AnchorPoint or Vector2.new(0, 0)
	
	if props.Corner then
		local corner = Instance.new("UICorner")
		corner.CornerRadius = UDim.new(0, props.Corner)
		corner.Parent = frame
	end
	
	frame.Parent = props.Parent
	return frame
end

-- Widget: Label
function UI.Label(props)
	local label = Instance.new("TextLabel")
	label.Name = props.Name or "Label"
	label.Text = props.Text or ""
	label.Font = props.Font or Theme.Fonts.Main
	label.TextSize = props.TextSize or 14
	label.TextColor3 = props.TextColor or Theme.Colors.TextMain
	label.Size = props.Size or UDim2.new(1, 0, 0, 20)
	label.Position = props.Position or UDim2.fromScale(0, 0)
	label.BackgroundTransparency = 1
	label.TextXAlignment = props.TextXAlignment or Enum.TextXAlignment.Left
	
	label.Parent = props.Parent
	return label
end

return UI</string>
        </Properties>
        <Item class="ModuleScript" referent="60">
          <Properties>
            <string name="Name">LoadingScreen</string>
            <string name="Source"><![CDATA[--[[
	LoadingScreen - Real progress tracking for game initialization
	Shows loading progress while controllers, services, and views load
]]
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")

local LoadingScreen = {}

local screenGui = nil
local progressBar = nil
local progressLabel = nil
local currentProgress = 0

function LoadingScreen.Create()
	local player = Players.LocalPlayer
	local playerGui = player:WaitForChild("PlayerGui")
	
	-- Create ScreenGui
	screenGui = Instance.new("ScreenGui")
	screenGui.Name = "LoadingScreen"
	screenGui.IgnoreGuiInset = true
	screenGui.ResetOnSpawn = false
	screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
	screenGui.DisplayOrder = 10
	screenGui.Parent = playerGui
	
	-- Background
	local background = Instance.new("Frame")
	background.Name = "Background"
	background.Size = UDim2.fromScale(1, 1)
	background.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
	background.BorderSizePixel = 0
	background.Parent = screenGui
	
	-- Container
	local container = Instance.new("Frame")
	container.Name = "Container"
	container.Size = UDim2.new(0, 600, 0, 200)
	container.Position = UDim2.fromScale(0.5, 0.5)
	container.AnchorPoint = Vector2.new(0.5, 0.5)
	container.BackgroundTransparency = 1
	container.Parent = screenGui
	
	-- Title
	local title = Instance.new("TextLabel")
	title.Name = "Title"
	title.Text = "WARZONE"
	title.Font = Enum.Font.GothamBlack
	title.TextSize = 48
	title.TextColor3 = Color3.fromRGB(0, 162, 255)
	title.Size = UDim2.new(1, 0, 0, 60)
	title.Position = UDim2.fromOffset(0, 0)
	title.BackgroundTransparency = 1
	title.Parent = container
	
	-- Status Label
	progressLabel = Instance.new("TextLabel")
	progressLabel.Name = "StatusLabel"
	progressLabel.Text = "Initializing..."
	progressLabel.Font = Enum.Font.GothamBold
	progressLabel.TextSize = 18
	progressLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
	progressLabel.Size = UDim2.new(1, 0, 0, 30)
	progressLabel.Position = UDim2.fromOffset(0, 70)
	progressLabel.BackgroundTransparency = 1
	progressLabel.Parent = container
	
	-- Progress Bar Background
	local progressBg = Instance.new("Frame")
	progressBg.Name = "ProgressBarBg"
	progressBg.Size = UDim2.new(1, 0, 0, 8)
	progressBg.Position = UDim2.fromOffset(0, 110)
	progressBg.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
	progressBg.BorderSizePixel = 0
	progressBg.Parent = container
	Instance.new("UICorner", progressBg).CornerRadius = UDim.new(0, 4)
	
	-- Progress Bar Fill
	progressBar = Instance.new("Frame")
	progressBar.Name = "ProgressBar"
	progressBar.Size = UDim2.fromScale(0, 1)
	progressBar.Position = UDim2.fromOffset(0, 0)
	progressBar.BackgroundColor3 = Color3.fromRGB(0, 162, 255)
	progressBar.BorderSizePixel = 0
	progressBar.Parent = progressBg
	Instance.new("UICorner", progressBar).CornerRadius = UDim.new(0, 4)
	
	-- Percentage Label
	local percentLabel = Instance.new("TextLabel")
	percentLabel.Name = "PercentLabel"
	percentLabel.Text = "0%"
	percentLabel.Font = Enum.Font.GothamBold
	percentLabel.TextSize = 16
	percentLabel.TextColor3 = Color3.fromRGB(180, 180, 180)
	percentLabel.Size = UDim2.new(1, 0, 0, 25)
	percentLabel.Position = UDim2.fromOffset(0, 125)
	percentLabel.BackgroundTransparency = 1
	percentLabel.Parent = container
	
	-- Store reference for updates
	LoadingScreen._percentLabel = percentLabel
	
	return screenGui
end

function LoadingScreen.SetProgress(progress, status)
	progress = math.clamp(progress, 0, 100)
	currentProgress = progress
	
	if progressBar then
		local targetSize = UDim2.fromScale(progress / 100, 1)
		TweenService:Create(progressBar, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
			Size = targetSize
		}):Play()
	end
	
	if progressLabel and status then
		progressLabel.Text = status
	end
	
	if LoadingScreen._percentLabel then
		LoadingScreen._percentLabel.Text = math.floor(progress) .. "%"
	end
end

function LoadingScreen.Hide()
	if screenGui then
		-- Fade out animation
		local fadeOut = TweenService:Create(screenGui, TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
			BackgroundTransparency = 1
		})
		
		fadeOut:Play()
		fadeOut.Completed:Connect(function()
			screenGui:Destroy()
			screenGui = nil
		end)
	end
end

function LoadingScreen.GetProgress()
	return currentProgress
end

return LoadingScreen
]]></string>
          </Properties>
        </Item>
        <Item class="Folder" referent="61">
          <Properties>
            <string name="Name">Views</string>
          </Properties>
          <Item class="ModuleScript" referent="62">
            <Properties>
              <string name="Name">HomeView</string>
              <string name="Source"><![CDATA[--[[
	HomeView - Main menu/PLAY view
	Implements the full lobby/matchmaking interface per Mainmenu.md documentation
]]
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local Controllers = script.Parent.Parent.Parent.Controllers

-- Safe require with fallbacks
local MatchmakingController = nil
local PlayerDataController = nil
local Theme = nil

local success1, mc = pcall(function()
	if Controllers then
		local module = Controllers:FindFirstChild("MatchmakingController")
		if not module then
			module = Controllers:WaitForChild("MatchmakingController", 5)
		end
		if module then
			return require(module)
		end
	end
	return nil
end)
if success1 and mc then MatchmakingController = mc end

local success2, pdc = pcall(function()
	if Controllers then
		local module = Controllers:FindFirstChild("PlayerDataController")
		if not module then
			module = Controllers:WaitForChild("PlayerDataController", 5)
		end
		if module then
			return require(module)
		end
	end
	return nil
end)
if success2 and pdc then PlayerDataController = pdc end

local success3, theme = pcall(function()
	local shared = ReplicatedStorage:FindFirstChild("Shared")
	if not shared then
		shared = ReplicatedStorage:WaitForChild("Shared", 5)
	end
	if shared then
		local constants = shared:FindFirstChild("Constants")
		if not constants then
			constants = shared:WaitForChild("Constants", 5)
		end
		if constants then
			local themeModule = constants:FindFirstChild("Theme")
			if not themeModule then
				themeModule = constants:WaitForChild("Theme", 5)
			end
			if themeModule then
				return require(themeModule)
			end
		end
	end
	return nil
end)
if success3 and theme then Theme = theme end

local HomeView = {}

-- Fallback colors if Theme fails to load
local COLORS = Theme and Theme.Colors or {
	Background = Color3.fromRGB(15, 15, 15),
	Panel = Color3.fromRGB(30, 30, 35),
	AccentBlue = Color3.fromRGB(0, 162, 255),
	AccentGold = Color3.fromRGB(255, 215, 0),
	TextMain = Color3.fromRGB(255, 255, 255),
	TextSecondary = Color3.fromRGB(180, 180, 180),
}

function HomeView.Create(parent)
	local frame = Instance.new("Frame")
	frame.Name = "HomeView"
	frame.Size = UDim2.fromScale(1, 1)
	frame.BackgroundTransparency = 1
	frame.Parent = parent
	
	local player = Players.LocalPlayer
	
	-- Get initial data with safe fallbacks
	local lobbyState = {PlayerCount = 1, MaxPlayers = 100, Status = "Searching"}
	if MatchmakingController and MatchmakingController.GetLobbyState then
		local success, state = pcall(function() return MatchmakingController.GetLobbyState() end)
		if success then lobbyState = state end
	end
	
	local profile = {
		Level = 1,
		Currency = 0,
		Username = player.Name,
		XP = 0,
		MaxXP = 1000
	}
	if PlayerDataController and PlayerDataController.GetProfile then
		local success, prof = pcall(function() return PlayerDataController.GetProfile() end)
		if success and prof then profile = prof end
	end
	
	-- === LEFT SIDE: Lobby & Squad Info ===
	local leftPanel = Instance.new("Frame")
	leftPanel.Name = "LeftPanel"
	leftPanel.Size = UDim2.new(0, 300, 0, 400)
	leftPanel.Position = UDim2.fromOffset(40, 100)
	leftPanel.BackgroundTransparency = 1
	leftPanel.Parent = frame
	
	-- Lobby Status
	local lobbyLabel = Instance.new("TextLabel")
	lobbyLabel.Text = string.format("%d / %d waiting in lobby", lobbyState.PlayerCount, lobbyState.MaxPlayers)
	lobbyLabel.Font = (Theme and Theme.Fonts and Theme.Fonts.Bold) or Enum.Font.GothamBold
	lobbyLabel.TextSize = 18
	lobbyLabel.TextColor3 = COLORS.TextMain
	lobbyLabel.Size = UDim2.new(1, 0, 0, 30)
	lobbyLabel.Position = UDim2.fromOffset(0, 0)
	lobbyLabel.BackgroundTransparency = 1
	lobbyLabel.TextXAlignment = Enum.TextXAlignment.Left
	lobbyLabel.Parent = leftPanel
	
	-- Squad Info
	local squadLabel = Instance.new("TextLabel")
	squadLabel.Text = "Squad 1 / 3 Max"
	squadLabel.Font = (Theme and Theme.Fonts and Theme.Fonts.Main) or Enum.Font.Gotham
	squadLabel.TextSize = 14
	squadLabel.TextColor3 = COLORS.TextSecondary
	squadLabel.Size = UDim2.new(1, 0, 0, 25)
	squadLabel.Position = UDim2.fromOffset(0, 35)
	squadLabel.BackgroundTransparency = 1
	squadLabel.TextXAlignment = Enum.TextXAlignment.Left
	squadLabel.Parent = leftPanel
	
	-- Player Listing
	local playerFrame = Instance.new("Frame")
	playerFrame.Name = "PlayerListing"
	playerFrame.Size = UDim2.new(1, 0, 0, 50)
	playerFrame.Position = UDim2.fromOffset(0, 70)
	playerFrame.BackgroundColor3 = COLORS.Panel
	playerFrame.BackgroundTransparency = 0.3
	playerFrame.Parent = leftPanel
	Instance.new("UICorner", playerFrame).CornerRadius = UDim.new(0, 8)
	
	local playerNameLabel = Instance.new("TextLabel")
	playerNameLabel.Text = profile.Username
	playerNameLabel.Font = (Theme and Theme.Fonts and Theme.Fonts.Bold) or Enum.Font.GothamBold
	playerNameLabel.TextSize = 16
	playerNameLabel.TextColor3 = COLORS.TextMain
	playerNameLabel.Size = UDim2.new(1, -60, 1, 0)
	playerNameLabel.Position = UDim2.fromOffset(10, 0)
	playerNameLabel.BackgroundTransparency = 1
	playerNameLabel.TextXAlignment = Enum.TextXAlignment.Left
	playerNameLabel.Parent = playerFrame
	
	local levelLabel = Instance.new("TextLabel")
	levelLabel.Text = tostring(profile.Level or 1)
	levelLabel.Font = (Theme and Theme.Fonts and Theme.Fonts.Bold) or Enum.Font.GothamBold
	levelLabel.TextSize = 14
	levelLabel.TextColor3 = COLORS.AccentGold
	levelLabel.Size = UDim2.new(0, 40, 1, 0)
	levelLabel.Position = UDim2.new(1, -50, 0, 0)
	levelLabel.BackgroundTransparency = 1
	levelLabel.Parent = playerFrame
	
	-- === CENTER: Character Display Area (Placeholder) ===
	local centerArea = Instance.new("Frame")
	centerArea.Name = "CenterArea"
	centerArea.Size = UDim2.new(0, 400, 0, 500)
	centerArea.Position = UDim2.new(0.5, -200, 0.5, -250)
	centerArea.AnchorPoint = Vector2.new(0.5, 0.5)
	centerArea.BackgroundTransparency = 1
	centerArea.Parent = frame
	
	local centerLabel = Instance.new("TextLabel")
	centerLabel.Text = "Character Preview\n(3D Model Here)"
	centerLabel.Font = (Theme and Theme.Fonts and Theme.Fonts.Main) or Enum.Font.Gotham
	centerLabel.TextSize = 16
	centerLabel.TextColor3 = COLORS.TextSecondary
	centerLabel.Size = UDim2.fromScale(1, 1)
	centerLabel.BackgroundTransparency = 1
	centerLabel.TextWrapped = true
	centerLabel.Parent = centerArea
	
	-- === RIGHT SIDE: Player Resources & Challenges ===
	local rightPanel = Instance.new("Frame")
	rightPanel.Name = "RightPanel"
	rightPanel.Size = UDim2.new(0, 300, 0, 500)
	rightPanel.Position = UDim2.new(1, -340, 0, 100)
	rightPanel.AnchorPoint = Vector2.new(1, 0)
	rightPanel.BackgroundTransparency = 1
	rightPanel.Parent = frame
	
	-- Player Resources (Top Right)
	local resourcesFrame = Instance.new("Frame")
	resourcesFrame.Name = "Resources"
	resourcesFrame.Size = UDim2.new(1, 0, 0, 120)
	resourcesFrame.Position = UDim2.fromOffset(0, 0)
	resourcesFrame.BackgroundColor3 = COLORS.Panel
	resourcesFrame.BackgroundTransparency = 0.2
	resourcesFrame.Parent = rightPanel
	Instance.new("UICorner", resourcesFrame).CornerRadius = UDim.new(0, 8)
	
	local cpLabel = Instance.new("TextLabel")
	cpLabel.Text = "CP " .. tostring(profile.Currency or 0)
	cpLabel.Font = (Theme and Theme.Fonts and Theme.Fonts.Bold) or Enum.Font.GothamBold
	cpLabel.TextSize = 18
	cpLabel.TextColor3 = COLORS.AccentGold
	cpLabel.Size = UDim2.new(1, -20, 0, 25)
	cpLabel.Position = UDim2.fromOffset(10, 10)
	cpLabel.BackgroundTransparency = 1
	cpLabel.TextXAlignment = Enum.TextXAlignment.Left
	cpLabel.Parent = resourcesFrame
	
	local levelTextLabel = Instance.new("TextLabel")
	levelTextLabel.Text = "Level " .. tostring(profile.Level or 1)
	levelTextLabel.Font = (Theme and Theme.Fonts and Theme.Fonts.Bold) or Enum.Font.GothamBold
	levelTextLabel.TextSize = 16
	levelTextLabel.TextColor3 = COLORS.TextMain
	levelTextLabel.Size = UDim2.new(1, -20, 0, 25)
	levelTextLabel.Position = UDim2.fromOffset(10, 35)
	levelTextLabel.BackgroundTransparency = 1
	levelTextLabel.TextXAlignment = Enum.TextXAlignment.Left
	levelTextLabel.Parent = resourcesFrame
	
	local usernameLabel = Instance.new("TextLabel")
	usernameLabel.Text = profile.Username
	usernameLabel.Font = (Theme and Theme.Fonts and Theme.Fonts.Main) or Enum.Font.Gotham
	usernameLabel.TextSize = 14
	usernameLabel.TextColor3 = COLORS.TextSecondary
	usernameLabel.Size = UDim2.new(1, -20, 0, 20)
	usernameLabel.Position = UDim2.fromOffset(10, 60)
	usernameLabel.BackgroundTransparency = 1
	usernameLabel.TextXAlignment = Enum.TextXAlignment.Left
	usernameLabel.Parent = resourcesFrame
	
	-- XP Progress Bar
	local xpBg = Instance.new("Frame")
	xpBg.Name = "XPBar"
	xpBg.Size = UDim2.new(1, -20, 0, 6)
	xpBg.Position = UDim2.fromOffset(10, 85)
	xpBg.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
	xpBg.BorderSizePixel = 0
	xpBg.Parent = resourcesFrame
	Instance.new("UICorner", xpBg).CornerRadius = UDim.new(0, 3)
	
	local xpFill = Instance.new("Frame")
	xpFill.Size = UDim2.fromScale((profile.XP or 0) / (profile.MaxXP or 1000), 1)
	xpFill.BackgroundColor3 = COLORS.AccentBlue
	xpFill.BorderSizePixel = 0
	xpFill.Parent = xpBg
	Instance.new("UICorner", xpFill).CornerRadius = UDim.new(0, 3)
	
	-- Challenges Section
	local challengesFrame = Instance.new("Frame")
	challengesFrame.Name = "Challenges"
	challengesFrame.Size = UDim2.new(1, 0, 0, 350)
	challengesFrame.Position = UDim2.fromOffset(0, 130)
	challengesFrame.BackgroundColor3 = COLORS.Panel
	challengesFrame.BackgroundTransparency = 0.2
	challengesFrame.Parent = rightPanel
	Instance.new("UICorner", challengesFrame).CornerRadius = UDim.new(0, 8)
	
	local challengesTitle = Instance.new("TextLabel")
	challengesTitle.Text = "Daily Challenges"
	challengesTitle.Font = (Theme and Theme.Fonts and Theme.Fonts.Bold) or Enum.Font.GothamBold
	challengesTitle.TextSize = 16
	challengesTitle.TextColor3 = COLORS.TextMain
	challengesTitle.Size = UDim2.new(1, -20, 0, 30)
	challengesTitle.Position = UDim2.fromOffset(10, 10)
	challengesTitle.BackgroundTransparency = 1
	challengesTitle.TextXAlignment = Enum.TextXAlignment.Left
	challengesTitle.Parent = challengesFrame
	
	local challengesList = Instance.new("ScrollingFrame")
	challengesList.Name = "ChallengesList"
	challengesList.Size = UDim2.new(1, -20, 1, -50)
	challengesList.Position = UDim2.fromOffset(10, 40)
	challengesList.BackgroundTransparency = 1
	challengesList.ScrollBarThickness = 4
	challengesList.Parent = challengesFrame
	
	local challengesLayout = Instance.new("UIListLayout")
	challengesLayout.Padding = UDim.new(0, 10)
	challengesLayout.Parent = challengesList
	
	-- Add challenge items
	local challenges = PlayerDataController.GetChallenges() or {}
	for i, challenge in ipairs(challenges) do
		local challengeItem = Instance.new("Frame")
		challengeItem.Size = UDim2.new(1, 0, 0, 60)
		challengeItem.BackgroundTransparency = 1
		challengeItem.Parent = challengesList
		
		local challengeText = Instance.new("TextLabel")
		challengeText.Text = challenge.Title or "Challenge " .. i
		challengeText.Font = (Theme and Theme.Fonts and Theme.Fonts.Main) or Enum.Font.Gotham
		challengeText.TextSize = 12
		challengeText.TextColor3 = COLORS.TextMain
		challengeText.Size = UDim2.new(1, 0, 0, 20)
		challengeText.BackgroundTransparency = 1
		challengeText.TextXAlignment = Enum.TextXAlignment.Left
		challengeText.TextWrapped = true
		challengeText.Parent = challengeItem
		
		local progressText = Instance.new("TextLabel")
		progressText.Text = string.format("%d / %d", challenge.Progress or 0, challenge.Goal or 1)
		progressText.Font = (Theme and Theme.Fonts and Theme.Fonts.Main) or Enum.Font.Gotham
		progressText.TextSize = 11
		progressText.TextColor3 = COLORS.TextSecondary
		progressText.Size = UDim2.new(1, 0, 0, 15)
		progressText.Position = UDim2.fromOffset(0, 25)
		progressText.BackgroundTransparency = 1
		progressText.TextXAlignment = Enum.TextXAlignment.Left
		progressText.Parent = challengeItem
		
		local progressBarBg = Instance.new("Frame")
		progressBarBg.Size = UDim2.new(1, 0, 0, 4)
		progressBarBg.Position = UDim2.fromOffset(0, 45)
		progressBarBg.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
		progressBarBg.BorderSizePixel = 0
		progressBarBg.Parent = challengeItem
		Instance.new("UICorner", progressBarBg).CornerRadius = UDim.new(0, 2)
		
		local progressBarFill = Instance.new("Frame")
		progressBarFill.Size = UDim2.fromScale(math.min(1, (challenge.Progress or 0) / (challenge.Goal or 1)), 1)
		progressBarFill.BackgroundColor3 = COLORS.AccentBlue
		progressBarFill.BorderSizePixel = 0
		progressBarFill.Parent = progressBarBg
		Instance.new("UICorner", progressBarFill).CornerRadius = UDim.new(0, 2)
	end
	
	challengesList.CanvasSize = UDim2.new(0, 0, 0, challengesLayout.AbsoluteContentSize.Y)
	challengesLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
		challengesList.CanvasSize = UDim2.new(0, 0, 0, challengesLayout.AbsoluteContentSize.Y)
	end)
	
	-- === BOTTOM LEFT: Game Mode Selection ===
	local gameModeFrame = Instance.new("Frame")
	gameModeFrame.Name = "GameMode"
	gameModeFrame.Size = UDim2.new(0, 300, 0, 150)
	gameModeFrame.Position = UDim2.fromOffset(40, 1)
	gameModeFrame.AnchorPoint = Vector2.new(0, 1)
	gameModeFrame.BackgroundColor3 = COLORS.Panel
	gameModeFrame.BackgroundTransparency = 0.2
	gameModeFrame.Parent = frame
	Instance.new("UICorner", gameModeFrame).CornerRadius = UDim.new(0, 8)
	
	local modeTitle = Instance.new("TextLabel")
	modeTitle.Text = "Battle Royale"
	modeTitle.Font = (Theme and Theme.Fonts and Theme.Fonts.Bold) or Enum.Font.GothamBold
	modeTitle.TextSize = 20
	modeTitle.TextColor3 = COLORS.TextMain
	modeTitle.Size = UDim2.new(1, -20, 0, 30)
	modeTitle.Position = UDim2.fromOffset(10, 10)
	modeTitle.BackgroundTransparency = 1
	modeTitle.TextXAlignment = Enum.TextXAlignment.Left
	modeTitle.Parent = gameModeFrame
	
	local mapLabel = Instance.new("TextLabel")
	mapLabel.Text = "Map: Blackout"
	mapLabel.Font = (Theme and Theme.Fonts and Theme.Fonts.Main) or Enum.Font.Gotham
	mapLabel.TextSize = 14
	mapLabel.TextColor3 = COLORS.TextSecondary
	mapLabel.Size = UDim2.new(1, -20, 0, 25)
	mapLabel.Position = UDim2.fromOffset(10, 40)
	mapLabel.BackgroundTransparency = 1
	mapLabel.TextXAlignment = Enum.TextXAlignment.Left
	mapLabel.Parent = gameModeFrame
	
	-- Matchmaking Status
	local matchmakingLabel = Instance.new("TextLabel")
	local playersNeeded = math.max(0, lobbyState.MaxPlayers - lobbyState.PlayerCount)
	matchmakingLabel.Text = string.format("Looking for %d more players", playersNeeded)
	matchmakingLabel.Font = (Theme and Theme.Fonts and Theme.Fonts.Main) or Enum.Font.Gotham
	matchmakingLabel.TextSize = 12
	matchmakingLabel.TextColor3 = COLORS.AccentBlue
	matchmakingLabel.Size = UDim2.new(1, -20, 0, 20)
	matchmakingLabel.Position = UDim2.fromOffset(10, 70)
	matchmakingLabel.BackgroundTransparency = 1
	matchmakingLabel.TextXAlignment = Enum.TextXAlignment.Left
	matchmakingLabel.Parent = gameModeFrame
	
	-- Update lobby state when it changes (with safe checks)
	if MatchmakingController and MatchmakingController.LobbyChanged then
		MatchmakingController.LobbyChanged.Event:Connect(function(newState)
			if lobbyLabel and newState then
				lobbyLabel.Text = string.format("%d / %d waiting in lobby", newState.PlayerCount or 1, newState.MaxPlayers or 100)
				local playersNeeded = math.max(0, (newState.MaxPlayers or 100) - (newState.PlayerCount or 1))
				if matchmakingLabel then
					matchmakingLabel.Text = string.format("Looking for %d more players", playersNeeded)
				end
			end
		end)
	end
	
	-- Update profile when it changes (with safe checks)
	if PlayerDataController and PlayerDataController.ProfileChanged then
		PlayerDataController.ProfileChanged.Event:Connect(function(newProfile)
			if newProfile then
				if cpLabel then cpLabel.Text = "CP " .. tostring(newProfile.Currency or 0) end
				if levelTextLabel then levelTextLabel.Text = "Level " .. tostring(newProfile.Level or 1) end
				if usernameLabel then usernameLabel.Text = newProfile.Username or player.Name end
				if xpFill then xpFill.Size = UDim2.fromScale((newProfile.XP or 0) / (newProfile.MaxXP or 1000), 1) end
				if playerNameLabel then playerNameLabel.Text = newProfile.Username or player.Name end
				if levelLabel then levelLabel.Text = tostring(newProfile.Level or 1) end
			end
		end)
	end
	
	return frame
end

return HomeView
]]></string>
            </Properties>
          </Item>
          <Item class="ModuleScript" referent="63">
            <Properties>
              <string name="Name">LoadoutView</string>
              <string name="Source"><![CDATA[--[[
	LoadoutView - Weapons/loadout management view
	Shows the loadout editor interface
]]
local WeaponsMenu = require(script.Parent.Parent.Parent.Interface.Weapons.WeaponsMenu)

local LoadoutView = {}

function LoadoutView.Create(parent)
	return WeaponsMenu.Create(parent)
end

return LoadoutView
]]></string>
            </Properties>
          </Item>
        </Item>
      </Item>
    </Item>
  </Item>
  <Item class="Teams" referent="64">
    <Properties>
      <string name="Name">Teams</string>
    </Properties>
  </Item>
  <Item class="TextChatService" referent="65">
    <Properties>
      <string name="Name">TextChatService</string>
    </Properties>
    <Item class="ChatInputBarConfiguration" referent="66">
      <Properties>
        <string name="Name">ChatInputBarConfiguration</string>
      </Properties>
    </Item>
    <Item class="ChatWindowConfiguration" referent="67">
      <Properties>
        <string name="Name">ChatWindowConfiguration</string>
      </Properties>
    </Item>
  </Item>
  <Item class="Workspace" referent="68">
    <Properties>
      <string name="Name">Workspace</string>
      <bool name="FilteringEnabled">true</bool>
      <bool name="NeedsPivotMigration">false</bool>
    </Properties>
    <Item class="Part" referent="69">
      <Properties>
        <string name="Name">Baseplate</string>
        <bool name="Anchored">true</bool>
        <Color3uint8 name="Color3uint8">6512483</Color3uint8>
        <bool name="Locked">true</bool>
        <Vector3 name="Position">
          <X>0</X>
          <Y>-10</Y>
          <Z>0</Z>
        </Vector3>
        <Vector3 name="size">
          <X>512</X>
          <Y>20</Y>
          <Z>512</Z>
        </Vector3>
      </Properties>
    </Item>
    <Item class="SpawnLocation" referent="70">
      <Properties>
        <string name="Name">SpawnLocation</string>
        <bool name="Anchored">true</bool>
        <bool name="CanCollide">true</bool>
        <int name="Duration">0</int>
        <Vector3 name="Position">
          <X>0</X>
          <Y>0.5</Y>
          <Z>0</Z>
        </Vector3>
        <Vector3 name="size">
          <X>12</X>
          <Y>1</Y>
          <Z>12</Z>
        </Vector3>
      </Properties>
    </Item>
  </Item>
</roblox>